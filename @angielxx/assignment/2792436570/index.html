<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="/front_6th/favicon.ico"/>
  
    <title>[1팀 이은지] Chapter 4-1 성능 최적화  - 이은지 | 항해플러스 프론트엔드 6기</title>
    <meta name="description" content=" [항해플러스 프론트엔드 6기] 이은지님이 제출한 [1팀 이은지] Chapter 4-1 성능 최적화  과제를 확인하세요. 코드 구현, 문제 해결 과정, 피드백 내용을 상세히 살펴볼 수 있습니다." />
    <meta name="keywords" content="항해플러스, 프론트엔드, 개발자교육, React, TypeScript, JavaScript, 기술면접, 웹개발, 이은지, [1팀 이은지] Chapter 4-1 성능 최적화 , 과제상세, 코드리뷰, 피드백, Pull Request" />
    <meta property="og:title" content="[1팀 이은지] Chapter 4-1 성능 최적화  - 이은지 | 항해플러스 프론트엔드 6기" />
    <meta property="og:description" content=" [항해플러스 프론트엔드 6기] 이은지님이 제출한 [1팀 이은지] Chapter 4-1 성능 최적화  과제를 확인하세요. 코드 구현, 문제 해결 과정, 피드백 내용을 상세히 살펴볼 수 있습니다." />
    <meta property="og:image" content="/defaultThumbnail.jpg" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="[1팀 이은지] Chapter 4-1 성능 최적화  - 이은지 | 항해플러스 프론트엔드 6기" />
    <meta name="twitter:description" content=" [항해플러스 프론트엔드 6기] 이은지님이 제출한 [1팀 이은지] Chapter 4-1 성능 최적화  과제를 확인하세요. 코드 구현, 문제 해결 과정, 피드백 내용을 상세히 살펴볼 수 있습니다." />
    <meta name="twitter:image" content="/defaultThumbnail.jpg" />
  
  <script type="module" crossorigin src="/front_6th/assets/index-DtEqFcg_.js"></script>
  <link rel="stylesheet" crossorigin href="/front_6th/assets/index-BXO68frB.css">
</head>
<body>
<div id="root"><div data-slot="sidebar-wrapper" style="--sidebar-width:16rem;--sidebar-width-icon:3rem" class="group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full"><div class="min-h-screen flex w-full"><div class="group peer text-sidebar-foreground hidden md:block" data-state="expanded" data-collapsible="" data-variant="sidebar" data-side="left" data-slot="sidebar"><div data-slot="sidebar-gap" class="relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear group-data-[collapsible=offcanvas]:w-0 group-data-[side=right]:rotate-180 group-data-[collapsible=icon]:w-(--sidebar-width-icon)"></div><div data-slot="sidebar-container" class="fixed inset-y-0 z-10 hidden h-svh transition-[left,right,width] duration-200 ease-linear md:flex left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)] group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l w-64"><div data-sidebar="sidebar" data-slot="sidebar-inner" class="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"><div data-slot="sidebar-content" data-sidebar="content" class="flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden bg-card border-r border-border"><a class="p-4" href="/front_6th/" data-discover="true"><div class="flex items-center space-x-2 mb-6"><div class="w-8 h-8 bg-gradient-primary rounded-lg flex items-center justify-center"><span class="text-white font-bold text-sm">6기</span></div><h4 class="text-lg font-bold text-primary">항해플러스 프론트엔드</h4></div></a><div data-slot="sidebar-group" data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-slot="sidebar-group-label" data-sidebar="group-label" class="ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 text-muted-foreground px-4">학습 관리</div><div data-slot="sidebar-group-content" data-sidebar="group-content" class="w-full text-sm"><ul data-slot="sidebar-menu" data-sidebar="menu" class="flex w-full min-w-0 flex-col gap-1 px-2"><li data-slot="sidebar-menu-item" data-sidebar="menu-item" class="group/menu-item relative"><a data-slot="sidebar-menu-button" data-sidebar="menu-button" data-size="default" data-active="false" class="peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-hidden ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground text-sm h-12 text-foreground hover:bg-secondary hover:text-secondary-foreground rounded-lg transition-all duration-300" href="/front_6th/" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users h-5 w-5" aria-hidden="true"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><path d="M16 3.128a4 4 0 0 1 0 7.744"></path><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><circle cx="9" cy="7" r="4"></circle></svg><span class="ml-3">수강생 목록</span></a></li><li data-slot="sidebar-menu-item" data-sidebar="menu-item" class="group/menu-item relative"><a data-slot="sidebar-menu-button" data-sidebar="menu-button" data-size="default" data-active="false" class="peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-hidden ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground text-sm h-12 text-foreground hover:bg-secondary hover:text-secondary-foreground rounded-lg transition-all duration-300" href="/front_6th/assignments/" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open h-5 w-5" aria-hidden="true"><path d="M12 7v14"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path></svg><span class="ml-3">과제 목록</span></a></li></ul></div></div></div></div></div></div><div class="flex-1 min-w-0"><header class="h-12 flex items-center border-b border-border bg-card px-4"><button data-slot="sidebar-trigger" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-7 mr-4 text-white" data-sidebar="trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-left" aria-hidden="true"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path></svg><span class="sr-only">Toggle Sidebar</span></button><h4 class="text-lg font-semibold "><a href="/front_6th/@angielxx/" data-discover="true">angielxx<!-- --> 님의 상세페이지</a> ＞ <!-- -->[1팀 이은지] Chapter 4-1 성능 최적화 </h4></header><main class="p-6"><div><div class="card-wrap"><div data-slot="card" class="card text-card-foreground flex flex-col gap-6 shadow-sm mb-6 p-6 border border-gray-700 bg-gray-800 rounded-lg"><a href="https://github.com/hanghae-plus/front_6th_chapter4-1/pull/19" target="_blank"><div class="flex items-start gap-4"><div class="flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" height="32" aria-hidden="true" viewBox="0 0 24 24" width="32" fill="white" class="w-8 h-8"><path d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"></path></svg></div><div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-2"><h3 class="text-lg font-semibold text-white truncate">[1팀 이은지] Chapter 4-1 성능 최적화 </h3></div><div class="flex items-center gap-4 text-xs text-gray-500"><span>by <!-- -->angielxx</span><span>2025. 9. 2.</span></div></div></div></a></div></div><div class="overflow-auto"><div data-color-mode="dark" class="wmde-markdown wmde-markdown-color p-6 max-w-full" style="word-wrap:break-word;overflow-wrap:break-word"><h2 id="과제-체크포인트"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-체크포인트"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 체크포인트</h2>
<h3 id="배포-링크"><a class="anchor" aria-hidden="true" tabindex="-1" href="#배포-링크"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>배포 링크</h3>
<p><a href="https://angielxx.github.io/front_6th_chapter4-1/vanilla/">vanilla</a>
<a href="https://angielxx.github.io/front_6th_chapter4-1/react/">react</a></p>
<!-- -->
<h3 id="기본과제-vanilla-ssr--ssg"><a class="anchor" aria-hidden="true" tabindex="-1" href="#기본과제-vanilla-ssr--ssg"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>기본과제 (Vanilla SSR &amp; SSG)</h3>
<h4 id="express-ssr-서버"><a class="anchor" aria-hidden="true" tabindex="-1" href="#express-ssr-서버"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Express SSR 서버</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> Express 미들웨어 기반 서버 구현</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 개발/프로덕션 환경 분기 처리</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> HTML 템플릿 치환 (<code>&lt;!--app-html--&gt;</code>, <code>&lt;!--app-head--&gt;</code>)</li>
</ul>
<h4 id="서버-사이드-렌더링"><a class="anchor" aria-hidden="true" tabindex="-1" href="#서버-사이드-렌더링"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>서버 사이드 렌더링</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 서버에서 동작하는 Router 구현</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 서버 데이터 프리페칭 (상품 목록, 상품 상세)</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 서버 상태관리 초기화</li>
</ul>
<h4 id="클라이언트-hydration"><a class="anchor" aria-hidden="true" tabindex="-1" href="#클라이언트-hydration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>클라이언트 Hydration</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> <code>window.__INITIAL_DATA__</code> 스크립트 주입</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 클라이언트 상태 복원</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 서버-클라이언트 데이터 일치</li>
</ul>
<h4 id="static-site-generation"><a class="anchor" aria-hidden="true" tabindex="-1" href="#static-site-generation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Static Site Generation</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 동적 라우트 SSG (상품 상세 페이지들)</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 빌드 타임 페이지 생성</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 파일 시스템 기반 배포</li>
</ul>
<h3 id="심화과제-react-ssr--ssg"><a class="anchor" aria-hidden="true" tabindex="-1" href="#심화과제-react-ssr--ssg"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>심화과제 (React SSR &amp; SSG)</h3>
<h4 id="react-ssr"><a class="anchor" aria-hidden="true" tabindex="-1" href="#react-ssr"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>React SSR</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> <code>renderToString</code> 서버 렌더링</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> TypeScript SSR 모듈 빌드</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> Universal React Router (서버/클라이언트 분기)</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> React 상태관리 서버 초기화</li>
</ul>
<h4 id="react-hydration"><a class="anchor" aria-hidden="true" tabindex="-1" href="#react-hydration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>React Hydration</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> Hydration 불일치 방지</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 클라이언트 상태 복원</li>
</ul>
<h4 id="static-site-generation-1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#static-site-generation-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Static Site Generation</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 동적 라우트 SSG (상품 상세 페이지들)</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 빌드 타임 페이지 생성</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> 파일 시스템 기반 배포</li>
</ul>
<h1 id="회고"><a class="anchor" aria-hidden="true" tabindex="-1" href="#회고"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>회고</h1>
<p>왜 매주차 과제가 저에게는 고비일까요. 이번 과제도 겨우겨우 턱걸이로 완성했습니다. 처음 과제 주제를 맞이했을 때는 재밌을 것 같다고 생각했고, SSR 서버를 직접 구현해본다니 잘 만들어보고 싶었습니다..! 그러나 많은 허들 앞에서 무너져 어떻게든 패스만 받기 위해 주먹구구식으로 구현했습니다...</p>
<p>이번 회고는 과제를 진행하기에 급급하여 부족했던 학습 내용을 채우는 것을 위주로 회고를 작성해보려고 합니다!</p>
<h1 id="구현하면서-새롭게-알게-된-개념"><a class="anchor" aria-hidden="true" tabindex="-1" href="#구현하면서-새롭게-알게-된-개념"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>구현하면서 새롭게 알게 된 개념</h1>
<h2 id="1-클라이언트-코드를-서버-node-환경에서-실행하면-왜-안되나"><a class="anchor" aria-hidden="true" tabindex="-1" href="#1-클라이언트-코드를-서버-node-환경에서-실행하면-왜-안되나"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>1. 클라이언트 코드를 서버 Node 환경에서 실행하면 왜 안되나?</h2>
<p>서버를 구현하며 처음에는 html을 페이지 요청 경로에 맞는 페이지 컴포넌트를 실행하여 반환하게 하면 어떻게될까하여 아래 코드처럼 해봤습니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">HomePage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="const html = HomePage();
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>이 코드 때문에 아래 에러가 발생했습니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token known-class-name class-name">Error</span> <span class="token punctuation">[</span><span class="token constant">ERR_UNSUPPORTED_DIR_IMPORT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token maybe-class-name">Directory</span> <span class="token keyword module">import</span> <span class="token string">&#x27;/Users/angielee/Desktop/hanghae/front_6th_chapter4-1/packages/vanilla/src/components&#x27;</span> is not supported resolving <span class="token constant">ES</span> modules imported <span class="token keyword module">from</span> <span class="token operator">/</span><span class="token maybe-class-name">Users</span><span class="token operator">/</span>angielee<span class="token operator">/</span><span class="token maybe-class-name">Desktop</span><span class="token operator">/</span>hanghae<span class="token operator">/</span>front_6th_chapter4<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>packages<span class="token operator">/</span>vanilla<span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span><span class="token maybe-class-name">HomePage</span><span class="token punctuation">.</span><span class="token property-access">js</span>
</span></code><div class="copied" data-code="Error [ERR_UNSUPPORTED_DIR_IMPORT]: Directory import &#x27;/Users/angielee/Desktop/hanghae/front_6th_chapter4-1/packages/vanilla/src/components&#x27; is not supported resolving ES modules imported from /Users/angielee/Desktop/hanghae/front_6th_chapter4-1/packages/vanilla/src/pages/HomePage.js
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>단순히 생각해보자면 HomePage 컴포넌트가 템플릿 리터럴의 html 코드를 반환하고 있으니까 페이지 컴포넌트를 실행하면 html 코드를 만들 수 있는 것 아닌가? 싶지만..이 얘기는 페이지 컴포넌트가 실행되는 CSR 환경과 동일한 클라이언트 사이드, 즉 브라우저 환경일 때만 예상한대로 동작합니다.</p>
<p>하지만 서버에는 dom도 없고 window도 없기 때문에 기존에 CSR로 동작하던 앱을 그대로 서버 환경에서 실행하려고 하면 여러 문제가 발생합니다.</p>
<p>첫째, HomePage 컴포넌트 내부에서 사용하는 router.query나 document.getElementById 같은 브라우저 전용 API들이 Node.js 환경에서는 존재하지 않아 에러가 발생합니다.
둘째, ES 모듈 시스템에서 import { ProductList, SearchBar } from &quot;../components&quot;처럼 디렉토리를 직접 import하는 방식이 Node.js에서는 지원되지 않습니다. Node.js는 정확한 파일 경로와 확장자를 요구하기 때문에 모듈 해석 오류가 발생합니다.
셋째, withLifecycle로 감싸진 라이프사이클 함수들이 DOM 이벤트나 브라우저 API에 의존하고 있어 서버 환경에서는 정상 동작하지 않습니다.</p>
<h3 id="1브라우저-api시뮬레이션환경-구축"><a class="anchor" aria-hidden="true" tabindex="-1" href="#1브라우저-api시뮬레이션환경-구축"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><strong>1) 브라우저 API 시뮬레이션 환경 구축</strong></h3>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// packages/vanilla/src/utils/setupJsDom.js</span>
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setupServerJsdom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> dom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSDOM</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;!DOCTYPE html&gt;...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token comment">// 브라우저 전역 객체들을 Node.js에 주입</span>
</span><span class="code-line">  globalThis<span class="token punctuation">.</span><span class="token property-access">window</span> <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token property-access">window</span><span class="token punctuation">;</span>
</span><span class="code-line">  globalThis<span class="token punctuation">.</span><span class="token property-access">document</span> <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token property-access">window</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">;</span>
</span><span class="code-line">  globalThis<span class="token punctuation">.</span><span class="token property-access">localStorage</span> <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token property-access">window</span><span class="token punctuation">.</span><span class="token property-access">localStorage</span><span class="token punctuation">;</span>
</span><span class="code-line">  globalThis<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Element</span></span> <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token property-access">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Element</span></span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token comment">// ... 기타 브라우저 API들</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="// packages/vanilla/src/utils/setupJsDom.js
export async function setupServerJsdom() {
  const dom = new JSDOM(`&lt;!DOCTYPE html&gt;...`);
  
  // 브라우저 전역 객체들을 Node.js에 주입
  globalThis.window = dom.window;
  globalThis.document = dom.window.document;
  globalThis.localStorage = dom.window.localStorage;
  globalThis.Element = dom.window.Element;
  // ... 기타 브라우저 API들
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>Node.js 환경에서 존재하지 않는 DOM을 모킹하기 위해 이렇게 JSDOM을 사용해서 서버에 가짜 브라우저 환경을 만들어 document, window 등의 API를 사용할 수 있게 합니다. jsdom 라이브러리를 사용하여 가상의 HTML 문서와 DOM 트리를 메모리에 생성하고, 브라우저에서만 사용 가능한 DOM API들을 Node.js 환경에서도 호출할 수 있도록 시뮬레이션합니다.</p>
<p>이를 통해 서버 사이드 렌더링 과정에서 컴포넌트들이 document.getElementById(), localStorage, sessionStorage 같은 브라우저 전용 API를 사용하더라도 에러 없이 실행될 수 있습니다.</p>
<h3 id="2환경별코드-분기처리"><a class="anchor" aria-hidden="true" tabindex="-1" href="#2환경별코드-분기처리"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><strong>2) 환경별 코드 분기 처리</strong></h3>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// utils/envUtils.js</span>
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> isServer <span class="token operator">=</span> <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">SSR</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// HomePage.js에서 환경별 분기</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">search</span><span class="token operator">:</span> searchQuery<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> sort<span class="token punctuation">,</span> category1<span class="token punctuation">,</span> category2 <span class="token punctuation">}</span> <span class="token operator">=</span> 
</span><span class="code-line">  isServer <span class="token operator">?</span> query <span class="token operator">:</span> router<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">;</span>  <span class="token comment">// 서버에서는 파라미터로 받은 query 사용</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> products <span class="token operator">=</span> serverData<span class="token operator">?.</span>products <span class="token operator">||</span> productState<span class="token punctuation">.</span><span class="token property-access">products</span><span class="token punctuation">;</span>  <span class="token comment">// 서버 데이터 우선</span>
</span></code><div class="copied" data-code="// utils/envUtils.js
export const isServer = import.meta.env.SSR;

// HomePage.js에서 환경별 분기
const { search: searchQuery, limit, sort, category1, category2 } = 
  isServer ? query : router.query;  // 서버에서는 파라미터로 받은 query 사용

const products = serverData?.products || productState.products;  // 서버 데이터 우선
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>기존 코드대로 router.query를 사용하면 에러가 나기 때문에, 서버 환경에서는 브라우저 라우터 대신 서버에서 전달받은 파라미터로 전달받아 사용하도록 분기 처리했습니다.</p>
<h3 id="3모듈-경로-문제-해결"><a class="anchor" aria-hidden="true" tabindex="-1" href="#3모듈-경로-문제-해결"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><strong>3) 모듈 경로 문제 해결</strong></h3>
<p>디렉토리 import 방식이 Node.js에서 지원되지 않기 때문에</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// HomePage.js 내부 - Node.js에서 문제가 되는 부분</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ProductList</span><span class="token punctuation">,</span> <span class="token maybe-class-name">SearchBar</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&quot;../components&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// ❌ 디렉토리 import</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> router<span class="token punctuation">,</span> withLifecycle <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&quot;../router&quot;</span><span class="token punctuation">;</span>       <span class="token comment">// ❌ 디렉토리 import</span>
</span></code><div class="copied" data-code="// HomePage.js 내부 - Node.js에서 문제가 되는 부분
import { ProductList, SearchBar } from &quot;../components&quot;;  // ❌ 디렉토리 import
import { router, withLifecycle } from &quot;../router&quot;;       // ❌ 디렉토리 import
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>이렇게 HomePage.js 내부의 import문에서 에러가 발생합니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// 직접 import 대신 Vite를 통한 모듈 로드</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> vite<span class="token punctuation">.</span><span class="token method function property-access">ssrLoadModule</span><span class="token punctuation">(</span><span class="token string">&quot;/src/main-server.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="// 직접 import 대신 Vite를 통한 모듈 로드
const { render } = await vite.ssrLoadModule(&quot;/src/main-server.js&quot;);
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>그래서 이렇게 Vite에서 지원하는 ssrLoadModule 메서드를 사용하여 모듈을 import하면 Vite가 자동으로 모듈 경로를 해석하여 변환해주어 import문에서 발생하던 에러를 해결할 수 있습니다.</p>
<p>ssrLoadModule은 단순히 모듈을 로드하는 함수가 아니라, <strong>브라우저용 코드를 서버 환경에서 실행 가능하게 만드는 핵심 도구</strong>입니다.</p>
<p>직접 import를 시도하면 모듈 해석, 환경 호환성, 의존성 관리 등 수많은 문제가 발생하지만, ssrLoadModule을 사용하면 Vite가 이 모든 복잡성을 자동으로 해결해주어 개발자는 SSR 구현에만 집중할 수 있게 됩니다.</p>
<h2 id="2-서버-사이드에서는-상대-경로-url을-파싱할-수-없다"><a class="anchor" aria-hidden="true" tabindex="-1" href="#2-서버-사이드에서는-상대-경로-url을-파싱할-수-없다"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>2. 서버 사이드에서는 상대 경로 URL을 파싱할 수 없다?</h2>
<p>API 요청 경로를 파싱할 수 없다는 에러가 발생했습니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token maybe-class-name">Prefetch</span> error<span class="token operator">:</span> <span class="token known-class-name class-name">TypeError</span><span class="token operator">:</span> <span class="token maybe-class-name">Failed</span> to parse <span class="token constant">URL</span> <span class="token keyword module">from</span> <span class="token operator">/</span>api<span class="token operator">/</span>products<span class="token operator">?</span>page<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>limit<span class="token operator">=</span><span class="token number">20</span><span class="token operator">&amp;</span>sort<span class="token operator">=</span>price_asc
</span></code><div class="copied" data-code="Prefetch error: TypeError: Failed to parse URL from /api/products?page=1&amp;limit=20&amp;sort=price_asc
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>기존에 CSR 환경에서 동작하던 Mock 서버의 API 라우트가 상대 경로로 작성되어있는데, 이 경로에 대한 해석이 SSR 환경에서는 예상과 다르게 해석되기 때문에 파싱할 수 없다는 에러가 발생한 것입니다.</p>
<p><strong>에러가 발생한 정확한 시점</strong></p>
<ol>
<li><strong>사용자가 브라우저에서 홈페이지 접속</strong> (<a href="http://localhost:5174/">http://localhost:5174/</a>)</li>
<li><strong>Express 서버가 SSR 렌더링 시작</strong></li>
<li><strong>HomePage 컴포넌트의 prefetch 함수 실행</strong></li>
<li><strong>getProducts() 호출로 상품 데이터 미리 가져오기 시도</strong></li>
<li><strong>fetch(&#x27;/api/products?...&#x27;)에서 상대 경로 파싱 실패</strong></li>
<li><strong>Node.js 환경에서 &#x27;/api/products&#x27;를 절대 URL로 변환할 수 없어 에러 발생</strong></li>
</ol>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token operator">===</span> <span class="token constant">CSR</span> 환경 <span class="token function">시뮬레이션</span> <span class="token punctuation">(</span>브라우저<span class="token punctuation">)</span> <span class="token operator">===</span>
</span><span class="code-line">현재 페이지<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">localhost:5173</span><span class="token regex-delimiter">/</span></span>
</span><span class="code-line">상대 경로<span class="token operator">:</span> <span class="token operator">/</span>api<span class="token operator">/</span>products
</span><span class="code-line">브라우저 해석 결과<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">5173</span><span class="token operator">/</span>api<span class="token operator">/</span>products
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">===</span> <span class="token constant">SSR</span> <span class="token function">환경</span> <span class="token punctuation">(</span><span class="token maybe-class-name">Node</span><span class="token punctuation">.</span><span class="token property-access">js</span> 서버<span class="token punctuation">)</span> <span class="token operator">===</span>
</span><span class="code-line">현재 환경<span class="token operator">:</span> <span class="token maybe-class-name">Node</span><span class="token punctuation">.</span><span class="token property-access">js</span> 서버
</span><span class="code-line">상대 경로<span class="token operator">:</span> <span class="token operator">/</span>api<span class="token operator">/</span>products
</span><span class="code-line"><span class="token maybe-class-name">Node</span><span class="token punctuation">.</span><span class="token property-access">js</span> 해석 실패<span class="token operator">:</span> <span class="token maybe-class-name">Invalid</span> <span class="token constant">URL</span>
</span></code><div class="copied" data-code="=== CSR 환경 시뮬레이션 (브라우저) ===
현재 페이지: http://localhost:5173/
상대 경로: /api/products
브라우저 해석 결과: http://localhost:5173/api/products

=== SSR 환경 (Node.js 서버) ===
현재 환경: Node.js 서버
상대 경로: /api/products
Node.js 해석 실패: Invalid URL
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<h3 id="csr-환경브라우저에서의-상대-경로-해석-과정"><a class="anchor" aria-hidden="true" tabindex="-1" href="#csr-환경브라우저에서의-상대-경로-해석-과정"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>CSR 환경(브라우저)에서의 상대 경로 해석 과정</h3>
<p>현재 브라우저에서 실행되는 컨텍스트가 아래와 같을 때,</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// 브라우저에서 실행되는 상황</span>
</span><span class="code-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &quot;http://localhost:5173/&quot;</span>
</span><span class="code-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">origin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;http://localhost:5173&quot;</span>
</span><span class="code-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &quot;localhost:5173&quot;</span>
</span></code><div class="copied" data-code="// 브라우저에서 실행되는 상황
console.log(window.location.href);    // &quot;http://localhost:5173/&quot;
console.log(window.location.origin);  // &quot;http://localhost:5173&quot;
console.log(window.location.host);    // &quot;localhost:5173&quot;
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>fetch를 호출 시 브라우저는 아래와 같은 상대 경로를</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// CSR에서 API 호출</span>
</span><span class="code-line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/products?page=1&amp;limit=20&amp;sort=price_asc&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="// CSR에서 API 호출
fetch(&#x27;/api/products?page=1&amp;limit=20&amp;sort=price_asc&#x27;);
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>현재 브라우저 환경의 origin과 상대경로를 더하여 최종 해석된 URL을 사용합니다.</p>
<ul>
<li>현재 origin: <a href="http://localhost:5173/">http://localhost:5173/</a></li>
<li>상대 경로: /api/products?page=1&amp;limit=20&amp;sort=price_asc</li>
<li>결합 결과: <a href="http://localhost:5173/api/products?page=1&amp;limit=20&amp;sort=price_asc">http://localhost:5173/api/products?page=1&amp;limit=20&amp;sort=price_asc</a></li>
</ul>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// 브라우저의 내부 동작 (의사코드)</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">resolveURL</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">relativePath</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> baseURL <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">origin</span><span class="token punctuation">;</span> <span class="token comment">// &quot;http://localhost:5173&quot;</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">,</span> baseURL<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 자동으로 결합</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">resolveURL</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/products?page=1&amp;limit=20&amp;sort=price_asc&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</span><span class="code-line"><span class="token comment">// → URL { </span>
</span><span class="code-line"><span class="token comment">//     href: &quot;http://localhost:5173/api/products?page=1&amp;limit=20&amp;sort=price_asc&quot;,</span>
</span><span class="code-line"><span class="token comment">//     pathname: &quot;/api/products&quot;,</span>
</span><span class="code-line"><span class="token comment">//     search: &quot;?page=1&amp;limit=20&amp;sort=price_asc&quot;</span>
</span><span class="code-line"><span class="token comment">//   }</span>
</span></code><div class="copied" data-code="// 브라우저의 내부 동작 (의사코드)
const resolveURL = (relativePath) =&gt; {
  const baseURL = window.location.origin; // &quot;http://localhost:5173&quot;
  return new URL(relativePath, baseURL);   // 자동으로 결합
};

console.log(resolveURL(&#x27;/api/products?page=1&amp;limit=20&amp;sort=price_asc&#x27;)); 
// → URL { 
//     href: &quot;http://localhost:5173/api/products?page=1&amp;limit=20&amp;sort=price_asc&quot;,
//     pathname: &quot;/api/products&quot;,
//     search: &quot;?page=1&amp;limit=20&amp;sort=price_asc&quot;
//   }
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<h3 id="ssr-환경서버에서의-상대-경로-해석-과정"><a class="anchor" aria-hidden="true" tabindex="-1" href="#ssr-환경서버에서의-상대-경로-해석-과정"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>SSR 환경(서버)에서의 상대 경로 해석 과정</h3>
<p>서버 환경에서의 실행 컨텍스트가 아래와 같고, 웹 컨텍스트에 대한 정보가 전혀 없습니다!</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// Node.js 서버에서의 상황</span>
</span><span class="code-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// &quot;/Users/.../front_6th_chapter4-1&quot;</span>
</span><span class="code-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// &quot;/Users/.../packages/vanilla&quot;</span>
</span><span class="code-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token dom variable">window</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// &quot;undefined&quot;</span>
</span></code><div class="copied" data-code="// Node.js 서버에서의 상황
console.log(process.cwd());           // &quot;/Users/.../front_6th_chapter4-1&quot;
console.log(__dirname);              // &quot;/Users/.../packages/vanilla&quot;
console.log(typeof window);          // &quot;undefined&quot;
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>그렇기 때문에 fetch를 실행할 때, fetch는 상대 경로를 해석하기 위해 브라우저 경로의 origin을 필요로 하는데, origin에 대한 정보가 없으므로 Base URL 없이 상대 경로만 제공됩니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// 브라우저의 내부 동작 (의사코드)</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">resolveURL</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">relativePath</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> baseURL <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">origin</span><span class="token punctuation">;</span> <span class="token comment">// &quot;http://localhost:5173&quot;</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">,</span> baseURL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Base URL 없이 상대 경로만 제공</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">resolveURL</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/products?page=1&amp;limit=20&amp;sort=price_asc&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</span><span class="code-line"><span class="token comment">// &quot;Invalid URL&quot;</span>
</span><span class="code-line"><span class="token comment">// &#x27;/api/products&#x27;는 상대 경로이므로 base URL 없이는 파싱 불가</span>
</span></code><div class="copied" data-code="// 브라우저의 내부 동작 (의사코드)
const resolveURL = (relativePath) =&gt; {
  const baseURL = window.location.origin; // &quot;http://localhost:5173&quot;
  return new URL(relativePath, baseURL); // Base URL 없이 상대 경로만 제공
};

console.log(resolveURL(&#x27;/api/products?page=1&amp;limit=20&amp;sort=price_asc&#x27;)); 
// &quot;Invalid URL&quot;
// &#x27;/api/products&#x27;는 상대 경로이므로 base URL 없이는 파싱 불가
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>그러므로! 서버 환경에서 상대 경로가 정상적으로 해석되려면 개발자가 상대 경로의 기준점을 명시적으로 제공해야합니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// packages/vanilla/src/api/productApi.js</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">getApiBaseUrl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token dom variable">window</span> <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// SSR 환경: 명시적으로 Base URL 제공</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token string">&quot;http://localhost:5174&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// CSR 환경: 브라우저가 자동 해석하도록 빈 문자열</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 사용</span>
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token parameter">productId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> baseUrl <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getApiBaseUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api/products/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>productId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="// packages/vanilla/src/api/productApi.js
const getApiBaseUrl = () =&gt; {
  if (typeof window === &quot;undefined&quot;) {
    // SSR 환경: 명시적으로 Base URL 제공
    return &quot;http://localhost:5174&quot;;
  } else {
    // CSR 환경: 브라우저가 자동 해석하도록 빈 문자열
    return &quot;&quot;;
  }
};

// 사용
export async function getProduct(productId) {
  const baseUrl = await getApiBaseUrl();
  const response = await fetch(`${baseUrl}/api/products/${productId}`);
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<h1 id="가장-어려웠던-부분과-해결-과정"><a class="anchor" aria-hidden="true" tabindex="-1" href="#가장-어려웠던-부분과-해결-과정"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>가장 어려웠던 부분과 해결 과정</h1>
<h2 id="홈-화면을-요청했는데-왜-상세-페이지가-보이지"><a class="anchor" aria-hidden="true" tabindex="-1" href="#홈-화면을-요청했는데-왜-상세-페이지가-보이지"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>홈 화면을 요청했는데, 왜 상세 페이지가 보이지?</h2>
<p>정말 이상한 현상이 발생했습니다. 로컬에서 SSR을 개발 서버에서 실행하면 아무 문제가 없는데, 테스트만 돌리면 SSR에서 에러가 났습니다. 심지어 에러는 상세 페이지에 대한 테스트에서 html이 홈 화면 html을 받거나, 홈 화면에서 상세 페이지에 대한 html을 받고 있었습니다.</p>
<h3 id="상태-공유state-sharing-문제"><a class="anchor" aria-hidden="true" tabindex="-1" href="#상태-공유state-sharing-문제"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><strong>상태 공유(State Sharing) 문제</strong></h3>
<p>테스트 환경에서 여러 테스트 케이스가 동시에 또는 순차적으로 실행될 때 서버 사이드 렌더링 과정에서 전역 상태나 모듈 상태가 공유되면서 발생하는 현상입니다.</p>
<p>개발 서버에서는 각 요청이 독립적으로 처리되고 브라우저에서 페이지 간 이동 시 완전히 새로운 컨텍스트가 생성되지만, 테스트 환경에서는 Node.js 프로세스 내에서 여러 SSR 렌더링이 빠르게 연속으로 실행됩니다. 이때 라우터 상태, 스토어 상태, 또는 전역 변수들이 이전 테스트의 실행 결과를 그대로 유지하고 있어서 다음 테스트에 영향을 미치게 됩니다.</p>
<p>에러가 발생했을 때 코드를 보면 ServerRouter를 다음과 같이 싱글톤 패턴으로 전역 객체로 구현하여 사용했습니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// packages/vanilla/src/lib/ServerRouter.js</span>
</span><span class="code-line"><span class="token comment">// 모듈 레벨에서 서버 라우터 인스턴스를 생성하여 단일 인스턴스를 공유하여 사용</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">ServerRouter</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token comment">// ...ServerRouter 구현체</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> serverRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code><div class="copied" data-code="// packages/vanilla/src/lib/ServerRouter.js
// 모듈 레벨에서 서버 라우터 인스턴스를 생성하여 단일 인스턴스를 공유하여 사용

class ServerRouter {
	// ...ServerRouter 구현체
}

export const serverRouter = new ServerRouter()
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>serverRouter를 모듈 레벨에서 싱글톤으로 생성하면, Node.js 프로세스가 살아있는 동안 동일한 인스턴스가 계속 재사용됩니다.</p>
<p>상세 페이지에 대한 테스트에서 상품 상세 페이지 <code>/product/12345/</code>를 렌더링하면 싱글톤 <code>serverRouter</code>의 내부 상태가 <code>#pathname = &quot;/product/12345/&quot;</code>, <code>#route = ProductDetailPage, #query = {}</code> 등으로 설정됩니다.이어서 홈 페이지에 대한 테스트에서 홈 페이지 <code>/</code>를 렌더링할 때 새로운 URL로 <code>start()</code> 메서드를 호출하지만, 이전 상태가 완전히 정리되지 않거나 다른 전역 상태와 얽혀서 예상치 못한 결과가 나타납니다.</p>
<p>특히 라우터뿐만 아니라 <code>productStore</code>, <code>cartStore</code> 같은 다른 전역 객체들도 마찬가지로 이전 테스트의 데이터를 유지하고 있기 때문에, 홈 페이지에서 이전에 로드된 상품 상세 정보가 표시되거나 반대로 상세 페이지에서 홈 페이지의 상품 목록이 나타나는 현상이 발생합니다.</p>
<h3 id="서버-요청마다-새로운-serverrouter-인스턴스를-생성"><a class="anchor" aria-hidden="true" tabindex="-1" href="#서버-요청마다-새로운-serverrouter-인스턴스를-생성"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>서버 요청마다 새로운 ServerRouter 인스턴스를 생성</h3>
<p>이 문제를 해결하기 위해서는 싱글톤 패턴을 포기하고 각 SSR 렌더링마다 새로운 ServerRouter 인스턴스를 생성하도록 했습니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// packages/vanilla/src/main-server.js</span>
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> serverRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  serverRouter<span class="token punctuation">.</span><span class="token method function property-access">addRoute</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token maybe-class-name">HomePage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  serverRouter<span class="token punctuation">.</span><span class="token method function property-access">addRoute</span><span class="token punctuation">(</span><span class="token string">&quot;/product/:id/&quot;</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ProductDetailPage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  serverRouter<span class="token punctuation">.</span><span class="token method function property-access">addRoute</span><span class="token punctuation">(</span><span class="token string">&quot;/404&quot;</span><span class="token punctuation">,</span> <span class="token maybe-class-name">NotFoundPage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  serverRouter<span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	
</span><span class="code-line">	<span class="token comment">// ..중략</span>
</span><span class="code-line">	
</span><span class="code-line">  <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword control-flow">await</span> serverRouter<span class="token punctuation">.</span><span class="token method function property-access">target</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> head<span class="token punctuation">,</span> <span class="token literal-property property">initialData</span><span class="token operator">:</span> data <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code><div class="copied" data-code="// packages/vanilla/src/main-server.js
export async function render(url) {
  const serverRouter = new ServerRouter();

  serverRouter.addRoute(&quot;/&quot;, HomePage);
  serverRouter.addRoute(&quot;/product/:id/&quot;, ProductDetailPage);
  serverRouter.addRoute(&quot;/404&quot;, NotFoundPage);

  serverRouter.start(url);
	
	// ..중략
	
  const html = await serverRouter.target(data, query);

  return { html, head, initialData: data };
}

"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>이렇게 하면 각 렌더링 요청마다 완전히 독립적인 라우터 컨텍스트가 생성되어 이전 요청의 상태가 다음 요청에 영향을 주지 않습니다.</p>
<p>결국 이 문제는 싱글톤 패턴의 전형적인 부작용으로, 서버 사이드 렌더링과 같이 동일한 코드가 여러 번 실행되는 환경에서는 상태 격리가 매우 중요하다는 것을 보여주는 사례입니다. 각 렌더링 요청이 완전히 독립적인 컨텍스트를 가져야 하므로, 전역 상태보다는 함수 스코프 내에서 생성되는 지역 상태나 의존성 주입 패턴을 사용하는 것이 더 좋다는 것을 배웠습니다!</p>
<h2 id="성능-최적화-관점에서의-인사이트"><a class="anchor" aria-hidden="true" tabindex="-1" href="#성능-최적화-관점에서의-인사이트"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>성능 최적화 관점에서의 인사이트</h2>
<!-- -->
<h2 id="학습-갈무리"><a class="anchor" aria-hidden="true" tabindex="-1" href="#학습-갈무리"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>학습 갈무리</h2>
<h3 id="q1-현재-구현한-ssrssg-아키텍처에서-확장성을-고려할-때-어떤-부분을-개선하시겠습니까"><a class="anchor" aria-hidden="true" tabindex="-1" href="#q1-현재-구현한-ssrssg-아키텍처에서-확장성을-고려할-때-어떤-부분을-개선하시겠습니까"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q1. 현재 구현한 SSR/SSG 아키텍처에서 확장성을 고려할 때 어떤 부분을 개선하시겠습니까?</h3>
<p><strong>캐싱 시스템 도입</strong>이 가장 중요한 개선점입니다. 현재는 매 요청마다 서버에서 렌더링하는데, 자주 변경되지 않는 페이지들은 메모리나 Redis에 캐싱하여 응답 속도를 크게 개선할 수 있습니다. 또한 <strong>컴포넌트 단위 캐싱</strong>을 도입하여 페이지 전체가 아닌 개별 컴포넌트별로 캐시 전략을 다르게 적용할 수 있을 것 같습니다.</p>
<h3 id="q2-express-서버-대신-다른-런타임cloudflare-workers-vercel-edge-functions-등을-사용한다면-어떤-점을-수정해야-할까요"><a class="anchor" aria-hidden="true" tabindex="-1" href="#q2-express-서버-대신-다른-런타임cloudflare-workers-vercel-edge-functions-등을-사용한다면-어떤-점을-수정해야-할까요"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q2. Express 서버 대신 다른 런타임(Cloudflare Workers, Vercel Edge Functions 등)을 사용한다면 어떤 점을 수정해야 할까요?</h3>
<p><strong>Cloudflare Workers</strong>는 더욱 제약이 심해서 현재의 폴리필 방식으로는 작동하지 않습니다. setupJsDom.js에서 globalThis.window를 전역에 추가하는 대신 Worker 환경에 맞는 별도의 추상화 레이어를 구축해야 합니다.</p>
<p><strong>Vercel Edge Functions</strong>의 경우 현재 Node.js 22 기반의 fetch API를 그대로 활용할 수 있지만, 파일 시스템 접근이 제한되므로 static-site-generate.js의 fs.writeFileSync 부분을 클라우드 스토리지 API로 대체해야 합니다. <strong>Cold Start 문제</strong>는 모든 서버리스 환경의 공통 이슈로, 번들 크기를 최소화하고 동적 import를 활용해 필요한 코드만 로드하도록 개선해야 합니다.</p>
<h3 id="q3-현재-구현에서-성능-병목이-될-수-있는-지점은-어디이고-어떻게-개선하시겠습니까"><a class="anchor" aria-hidden="true" tabindex="-1" href="#q3-현재-구현에서-성능-병목이-될-수-있는-지점은-어디이고-어떻게-개선하시겠습니까"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q3. 현재 구현에서 성능 병목이 될 수 있는 지점은 어디이고, 어떻게 개선하시겠습니까?</h3>
<p><strong>첫 번째 병목점은 SSR 렌더링 과정</strong>입니다. 현재 main-server.js에서 매 요청마다 vite.ssrLoadModule을 호출하고 전체 컴포넌트 트리를 렌더링합니다. 이를 개선하기 위해 <strong>청크 단위 로딩</strong>과 <strong>컴포넌트별 lazy loading</strong>을 도입할 수 있습니다.</p>
<p><strong>두 번째는 데이터 프리페칭 단계</strong>입니다. HomePage.prefetch에서 Promise.all([getProducts(query), getCategories()])로 병렬 처리하고 있지만, 데이터 의존성이 없는 경우 더 세밀한 최적화가 가능합니다. 또한 현재 MSW를 통한 Mock 응답도 실제 프로덕션에서는 <strong>GraphQL DataLoader 패턴</strong>이나 <strong>배치 쿼리</strong>로 N+1 문제를 해결해야 합니다.</p>
<p><strong>세 번째는 하이드레이션 과정</strong>입니다. 현재 hydrateStore에서 전체 초기 데이터를 한 번에 로드하는데, 이를 <strong>점진적 하이드레이션</strong>으로 개선하여 사용자가 상호작용하는 부분부터 우선 활성화할 수 있습니다.</p>
<h3 id="q4-1000개-이상의-상품-페이지를-ssg로-생성할-때-고려해야-할-사항은-무엇입니까"><a class="anchor" aria-hidden="true" tabindex="-1" href="#q4-1000개-이상의-상품-페이지를-ssg로-생성할-때-고려해야-할-사항은-무엇입니까"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q4. 1000개 이상의 상품 페이지를 SSG로 생성할 때 고려해야 할 사항은 무엇입니까?</h3>
<p>현재 static-site-generate.js는 순차적으로 페이지를 생성하므로 <strong>병렬 처리</strong>가 필수입니다. for (const page of pages) 루프를 Promise.all이나 pMap으로 개선하되, 메모리 사용량을 고려해 <strong>동시 실행 수를 제한</strong>해야 합니다.</p>
<p><strong>증분 빌드</strong> 시스템도 중요합니다. 모든 상품을 매번 재생성하는 대신, 변경된 상품만 감지하여 해당 페이지만 다시 생성하는 로직이 필요합니다. 이를 위해 <strong>해시 기반 변경 감지</strong>나 <strong>타임스탬프 비교</strong>를 활용할 수 있습니다.</p>
<p>또한 현재는 getProducts()로 모든 상품을 메모리에 로드하는데, 1000개 이상에서는 <strong>스트리밍 방식</strong>으로 페이지 단위로 데이터를 가져와 메모리 사용량을 제한해야 합니다. <strong>CDN 캐시 무효화 전략</strong>도 중요한데, 상품별로 독립적인 캐시 키를 설정하여 특정 상품 변경 시 전체 캐시를 무효화하지 않도록 해야 합니다.</p>
<h3 id="q5-hydration-과정에서-사용자가-느낄-수-있는-ux-이슈는-무엇이고-어떻게-개선할-수-있을까요"><a class="anchor" aria-hidden="true" tabindex="-1" href="#q5-hydration-과정에서-사용자가-느낄-수-있는-ux-이슈는-무엇이고-어떻게-개선할-수-있을까요"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q5. Hydration 과정에서 사용자가 느낄 수 있는 UX 이슈는 무엇이고, 어떻게 개선할 수 있을까요?</h3>
<p>현재 hydrateStore에서 delete window.__INITIAL_DATA__로 초기 데이터를 제거하는데, 이 과정에서 <strong>Flash of Unstyled Content (FOUC)</strong> 문제가 발생할 수 있습니다. 서버에서 렌더링된 HTML과 클라이언트에서 하이드레이션된 결과가 일시적으로 다를 수 있기 때문입니다.</p>
<p><strong>인터랙션 차단 시간</strong>도 중요한 이슈입니다. 현재는 main.tsx에서 hydrateStore() 완료 후에야 React 앱이 마운트되므로, 큰 초기 데이터에서는 사용자가 오랫동안 클릭할 수 없는 상태가 됩니다. 이를 <strong>Progressive Enhancement</strong>로 개선하여 기본 HTML부터 상호작용 가능하게 하고, JavaScript가 로드되면서 점진적으로 기능을 활성화해야 합니다.</p>
<p><strong>Skeleton UI</strong>나 <strong>Loading Spinner</strong> 같은 로딩 상태 표시도 현재는 구현되어 있지 않습니다. productStore의 loading 상태를 활용하여 하이드레이션 진행 상황을 사용자에게 명확히 보여주어야 합니다.</p>
<h3 id="q6-이번-과제에서-학습한-내용을-실제-프로덕션-환경에-적용할-때-추가로-고려해야-할-사항은"><a class="anchor" aria-hidden="true" tabindex="-1" href="#q6-이번-과제에서-학습한-내용을-실제-프로덕션-환경에-적용할-때-추가로-고려해야-할-사항은"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q6. 이번 과제에서 학습한 내용을 실제 프로덕션 환경에 적용할 때 추가로 고려해야 할 사항은?</h3>
<p><strong>보안 측면</strong>에서 현재 window.__INITIAL_DATA__에 모든 데이터를 노출하는 방식은 민감한 정보 유출 위험이 있습니다. 사용자별 데이터는 별도 API 호출로 분리하고, <strong>CSP(Content Security Policy)</strong> 설정으로 XSS 공격을 방어해야 합니다.</p>
<h3 id="q7-nextjs-같은-프레임워크-대신-직접-구현한-ssrssg의-장단점은-무엇인가요"><a class="anchor" aria-hidden="true" tabindex="-1" href="#q7-nextjs-같은-프레임워크-대신-직접-구현한-ssrssg의-장단점은-무엇인가요"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q7. Next.js 같은 프레임워크 대신 직접 구현한 SSR/SSG의 장단점은 무엇인가요?</h3>
<p><strong>장점</strong>으로는 <strong>완전한 제어권</strong>을 들 수 있습니다. 현재 구현한 ServerRouter나 createStore 같은 라이브러리는 프로젝트 요구사항에 정확히 맞춰져 있고, 불필요한 기능이 없어 번들 크기가 작습니다. 또한 <strong>학습 효과</strong>가 뛰어나 SSR/SSG의 내부 동작 원리를 완전히 이해할 수 있습니다.</p>
<p><strong>단점</strong>으로는 <strong>유지보수 비용</strong>이 큽니다. Next.js는 수많은 엣지 케이스와 브라우저 호환성 문제를 이미 해결했지만, 직접 구현한 코드는 이런 문제들을 하나씩 마주치며 해결해야 합니다. <strong>생태계 지원</strong>도 부족해서 이미지 최적화, 국제화, 성능 모니터링 같은 기능을 모두 직접 구현해야 합니다.</p>
<p><strong>커뮤니티와 문서화</strong> 측면에서도 Next.js는 풍부한 자료와 플러그인을 제공하지만, 직접 구현한 시스템은 팀 내에서만 알고 있는 &quot;블랙박스&quot;가 될 위험이 있습니다.</p>
<h3 id="q8-nextjs-를-이용하여-ssg-방식으로-배포하려면-어떻게-해야-좋을까요"><a class="anchor" aria-hidden="true" tabindex="-1" href="#q8-nextjs-를-이용하여-ssg-방식으로-배포하려면-어떻게-해야-좋을까요"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Q8. Next.js 를 이용하여 SSG 방식으로 배포하려면 어떻게 해야 좋을까요?</h3>
<p>Next.js로 마이그레이션한다면 현재의 static-site-generate.js 로직을 <strong>getStaticPaths와 getStaticProps</strong>로 변환해야 합니다. 상품 목록은 getStaticPaths에서 생성하고, 각 상품 데이터는 getStaticProps에서 프리페치합니다.</p>
<p>현재 프로젝트 구조를 Next.js에 맞게 변환하면:</p>
<ul>
<li>packages/vanilla/src/pages/ → pages/ 디렉토리 구조</li>
<li>ServerRouter → Next.js의 내장 라우터로 대체</li>
<li>productStore → <strong>SWR이나 React Query</strong>로 상태 관리 개선</li>
<li>setupJsDom → 불필요 (Next.js가 자동 처리)</li>
</ul>
<p><strong>배포 전략</strong>으로는 <strong>Vercel이나 Netlify</strong>에서 next export로 정적 파일을 생성하거나, **ISR(Incremental Static Regeneration)**을 활용하여 상품 변경 시 해당 페이지만 재생성하는 방식을 권장합니다. 현재 MSW 기반의 Mock API는 <strong>실제 API 서버나 Headless CMS</strong>로 대체하여 데이터 소스를 명확히 해야 합니다.</p>
<h2 id="학습-연계"><a class="anchor" aria-hidden="true" tabindex="-1" href="#학습-연계"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>학습 연계</h2>
<h3 id="다음-학습-목표"><a class="anchor" aria-hidden="true" tabindex="-1" href="#다음-학습-목표"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>다음 학습 목표</h3>
<p>&quot;Edge Computing과 CDN 기반 SSR 최적화&quot; - 현재 Node.js 서버 기반의 SSR을 Cloudflare Workers나 Vercel Edge Functions 같은 Edge 환경으로 이전했을 때의 성능 향상과 구현 방식 차이점을 학습하고 싶습니다. 특히 setupJsDom.js에서 구현한 브라우저 폴리필 방식이 Edge 환경에서는 어떻게 대체되어야 하는지 깊이 알고 싶습니다.</p>
<h2 id="리뷰-받고-싶은-내용"><a class="anchor" aria-hidden="true" tabindex="-1" href="#리뷰-받고-싶은-내용"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>리뷰 받고 싶은 내용</h2>
</div></div><div class="overflow-auto mt-9"><div data-color-mode="dark" class="wmde-markdown wmde-markdown-color p-6 max-w-full" style="word-wrap:break-word;overflow-wrap:break-word"><h2 id="과제-피드백"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-피드백"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 피드백</h2>
<p>수고했습니다. 이번 과제는 SSR과 SSG를 직접 구현해보면서 렌더링 전략의 차이점과 성능 최적화 방법을 체험하는데 목적이 있었습니다.</p>
<p>&quot;왜 매주차 과제가 저에게는 고비일까요. 이번 과제도 겨우겨우 턱걸이로 완성했습니다.&quot; ㅋㅋ 그만큼 가파른 성장을 하고 있다는 거겠죠! 완성을 했다는것 자체가 아주 중요합니다. 한번 하고 나면 두번은 쉬울 거에요.</p>
<p>&quot;...하지만 서버에는 dom도 없고 window도 없기 때문에 기존에 CSR로 동작하던 앱을 그대로 서버 환경에서 실행하려고 하면 여러 문제가 발생합니다.&quot; 맞아요! 같은 코드를 사용하지만 Node와 Browser가 달라지는 부분을 추상화하는 것도 SSR의 가장 큰 미션이죠. JSDOM을 활용한 브라우저 API 시뮬레이션 환경 구축이나 <code>ssrLoadModule</code>을 통한 모듈 경로 문제 해결 등 실질적인 해결책들을 직접 구현해보면서 SSR의 복잡성을 체험하게 되었으리라 생각합니다.</p>
<p>상대 경로 URL 파싱 문제도 흥미로운 케이스였어요. CSR과 SSR 환경에서 같은 <code>/api/products</code> 경로가 어떻게 다르게 해석되는지 명확하게 분석했고, <code>getApiBaseUrl()</code> 함수로 환경별 분기 처리한 해결책도 현실적입니다.</p>
<p>특히 테스트 환경에서 발생한 상태 공유 문제 분석이 깊이 있었어요. &quot;홈 화면을 요청했는데 왜 상세 페이지가 보이지?&quot;라는 의문에서 시작해서 싱글톤 패턴의 부작용까지 찾아낸 과정이 훌륭했습니다. 각 SSR 렌더링마다 새로운 Router 인스턴스를 생성하는 해결책도 맞고요.</p>
<p>이번 과제를 통해 단순히 기능을 구현하는 것을 넘어서 왜 이런 문제들이 발생하는지, 어떻게 해결해야 하는지까지 깊이 탐구해보신 경험이 앞으로 성능 최적화할 때 큰 자산이 될 거예요. 수고하셨습니다. 다음 과제도 화이팅입니다!</p></div></div><div class="mt-9"></div></div></main></div></div></div></div>
<script src="https://www.googletagmanager.com/gtag/js?id=G-6J8QP7YK1E"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6J8QP7YK1E');
</script>
</body>
</html>
