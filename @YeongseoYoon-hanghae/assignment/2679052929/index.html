<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>항해플러스 프론트엔드 6기 기술블로그</title>
  <link rel="icon" href="/front_6th/favicon.ico"/>
  
  <script type="module" crossorigin src="/front_6th/assets/index-Drf7uASk.js"></script>
  <link rel="stylesheet" crossorigin href="/front_6th/assets/index-Dvjhel9t.css">
</head>
<body>
<div id="root"><link rel="preload" as="image" href="https://github.com/user-attachments/assets/2766aaf5-3881-47bb-9cba-41dc5449729e"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/d5994825-7bf7-4090-801c-16aa96aedbd8"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/159732ca-0c1d-4ccb-b169-ab24cb406381"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/1e3c04b6-bd99-4931-b8bc-bdd53cfc0f39"/><div data-slot="sidebar-wrapper" style="--sidebar-width:16rem;--sidebar-width-icon:3rem" class="group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full"><div class="min-h-screen flex w-full"><div class="group peer text-sidebar-foreground hidden md:block" data-state="expanded" data-collapsible="" data-variant="sidebar" data-side="left" data-slot="sidebar"><div data-slot="sidebar-gap" class="relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear group-data-[collapsible=offcanvas]:w-0 group-data-[side=right]:rotate-180 group-data-[collapsible=icon]:w-(--sidebar-width-icon)"></div><div data-slot="sidebar-container" class="fixed inset-y-0 z-10 hidden h-svh transition-[left,right,width] duration-200 ease-linear md:flex left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)] group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l w-64"><div data-sidebar="sidebar" data-slot="sidebar-inner" class="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"><div data-slot="sidebar-content" data-sidebar="content" class="flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden bg-card border-r border-border"><a class="p-4" href="/front_6th/" data-discover="true"><div class="flex items-center space-x-2 mb-6"><div class="w-8 h-8 bg-gradient-primary rounded-lg flex items-center justify-center"><span class="text-white font-bold text-sm">6기</span></div><h4 class="text-lg font-bold text-primary">항해플러스 프론트엔드</h4></div></a><div data-slot="sidebar-group" data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-slot="sidebar-group-label" data-sidebar="group-label" class="ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 text-muted-foreground px-4">학습 관리</div><div data-slot="sidebar-group-content" data-sidebar="group-content" class="w-full text-sm"><ul data-slot="sidebar-menu" data-sidebar="menu" class="flex w-full min-w-0 flex-col gap-1 px-2"><li data-slot="sidebar-menu-item" data-sidebar="menu-item" class="group/menu-item relative"><a data-slot="sidebar-menu-button" data-sidebar="menu-button" data-size="default" data-active="false" class="peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-hidden ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground text-sm h-12 text-foreground hover:bg-secondary hover:text-secondary-foreground rounded-lg transition-all duration-300" href="/front_6th/" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users h-5 w-5" aria-hidden="true"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><path d="M16 3.128a4 4 0 0 1 0 7.744"></path><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><circle cx="9" cy="7" r="4"></circle></svg><span class="ml-3">수강생 목록</span></a></li><li data-slot="sidebar-menu-item" data-sidebar="menu-item" class="group/menu-item relative"><a data-slot="sidebar-menu-button" data-sidebar="menu-button" data-size="default" data-active="false" class="peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-hidden ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground text-sm h-12 text-foreground hover:bg-secondary hover:text-secondary-foreground rounded-lg transition-all duration-300" href="/front_6th/assignments" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open h-5 w-5" aria-hidden="true"><path d="M12 7v14"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path></svg><span class="ml-3">과제 목록</span></a></li></ul></div></div></div></div></div></div><div class="flex-1 min-w-0"><header class="h-12 flex items-center border-b border-border bg-card px-4"><button data-slot="sidebar-trigger" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-7 mr-4 text-white" data-sidebar="trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-left" aria-hidden="true"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path></svg><span class="sr-only">Toggle Sidebar</span></button><h4 class="text-lg font-semibold "><a href="/front_6th/@YeongseoYoon-hanghae/" data-discover="true">YeongseoYoon-hanghae<!-- --> 님의 상세페이지</a> ＞ <!-- -->[5팀 윤영서] Chapter 1-3. React, Beyond the Basics</h4></header><main class="p-6"><div><div class="card-wrap"><div data-slot="card" class="card text-card-foreground flex flex-col gap-6 shadow-sm mb-6 p-6 border border-gray-700 bg-gray-800 rounded-lg"><a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13" target="_blank"><div class="flex items-start gap-4"><div class="flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" height="32" aria-hidden="true" viewBox="0 0 24 24" width="32" fill="white" class="w-8 h-8"><path d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"></path></svg></div><div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-2"><h3 class="text-lg font-semibold text-white truncate">[5팀 윤영서] Chapter 1-3. React, Beyond the Basics</h3></div><div class="flex items-center gap-4 text-xs text-gray-500"><span>by <!-- -->YeongseoYoon-hanghae</span><span>2025. 7. 19.</span></div></div></div></a></div></div><div class="overflow-auto"><div data-color-mode="dark" class="wmde-markdown wmde-markdown-color p-6 max-w-full" style="word-wrap:break-word;overflow-wrap:break-word"><h1 id="과제-체크포인트"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-체크포인트"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 체크포인트</h1>
<h2 id="배포-링크"><a class="anchor" aria-hidden="true" tabindex="-1" href="#배포-링크"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>배포 링크</h2>
<p><a href="https://yeongseoyoon-hanghae.github.io/front_6th_chapter1-3/">https://yeongseoyoon-hanghae.github.io/front_6th_chapter1-3/</a></p>
<h2 id="기본과제"><a class="anchor" aria-hidden="true" tabindex="-1" href="#기본과제"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>기본과제</h2>
<h3 id="equalities"><a class="anchor" aria-hidden="true" tabindex="-1" href="#equalities"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>equalities</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> shallowEquals 구현 완료</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> deepEquals 구현 완료</li>
</ul>
<h3 id="hooks"><a class="anchor" aria-hidden="true" tabindex="-1" href="#hooks"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>hooks</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useRef 구현 완료</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useMemo 구현 완료</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useCallback 구현 완료</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useDeepMemo 구현 완료</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useShallowState 구현 완료</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useAutoCallback 구현 완료</li>
</ul>
<h3 id="high-order-components"><a class="anchor" aria-hidden="true" tabindex="-1" href="#high-order-components"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>High Order Components</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> memo 구현 완료</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> deepMemo 구현 완료</li>
</ul>
<h2 id="심화-과제"><a class="anchor" aria-hidden="true" tabindex="-1" href="#심화-과제"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>심화 과제</h2>
<h3 id="hooks-1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#hooks-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>hooks</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> createObserver를 useSyncExternalStore에 사용하기 적합한 코드로 개선</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useShallowSelector 구현</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useStore 구현</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useRouter 구현</li>
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> useStorage 구현</li>
</ul>
<h3 id="context"><a class="anchor" aria-hidden="true" tabindex="-1" href="#context"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>context</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="" checked=""/> ToastContext, ModalContext 개선</li>
</ul>
<h1 id="과제-셀프회고"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-셀프회고"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 셀프회고</h1>
<p>사실...과제 자체를 하는 것에는 엄청 오래걸리지 않았지만......코테 전형과 면접 준비를 위해.....과제를 뒤로 밀어두고...(주절주절...<del>)
암튼 과제하는 이번 주가 쉽지는 않았습니다...어쩌다보니 PR 정리를 위해 밤을 새는 대참사가</del></p>
<h2 id="기술적-성장"><a class="anchor" aria-hidden="true" tabindex="-1" href="#기술적-성장"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>기술적 성장</h2>
<h3 id="react-내부-동작-원리-이해"><a class="anchor" aria-hidden="true" tabindex="-1" href="#react-내부-동작-원리-이해"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>React 내부 동작 원리 이해</h3>
<p><code>useMemo</code>, <code>useCallback</code> 등의 훅을 직접 구현하면서 React가 내부적으로 어떻게 메모이제이션과 의존성 비교를 수행하는지 깊이 이해하게 되었습니다. <code>useRef</code>를 활용한 이전 값 저장과 <code>shallowEquals</code>를 통한 의존성 비교 로직을 구현하면서 React의 최적화 메커니즘을 이해할 수 있었습니다.</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useMemo</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function-variable function">factory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">,</span> _deps<span class="token operator">:</span> DependencyList<span class="token punctuation">,</span> _equals <span class="token operator">=</span> shallowEquals<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> prevDepsRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>DependencyList<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_deps<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> resultRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> depsChanged <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">_equals</span><span class="token punctuation">(</span>prevDepsRef<span class="token punctuation">.</span>current<span class="token punctuation">,</span> _deps<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>depsChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    resultRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    prevDepsRef<span class="token punctuation">.</span>current <span class="token operator">=</span> _deps<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> resultRef<span class="token punctuation">.</span>current <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="export function useMemo&lt;T&gt;(factory: () =&gt; T, _deps: DependencyList, _equals = shallowEquals): T {
  const prevDepsRef = useRef&lt;DependencyList&gt;(_deps);
  const resultRef = useRef&lt;T&gt;(factory());

  const depsChanged = !_equals(prevDepsRef.current, _deps);

  if (depsChanged) {
    resultRef.current = factory();
    prevDepsRef.current = _deps;
  }

  return resultRef.current as T;
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<h3 id="옵저버-패턴과-usesyncexternalstore"><a class="anchor" aria-hidden="true" tabindex="-1" href="#옵저버-패턴과-usesyncexternalstore"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>옵저버 패턴과 useSyncExternalStore</h3>
<p><code>createObserver</code>를 구현하면서 외부 상태 관리와 React의 동기화 메커니즘을 학습했습니다. 특히 <code>subscribe</code> 함수가 <code>unsubscribe</code> 함수를 반환하는 패턴이 <code>useSyncExternalStore</code>과 일치한 다는 점을 깨달았습니다.</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">const</span> subscribe <span class="token operator">=</span> <span class="token punctuation">(</span>listener<span class="token operator">:</span> Listener<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  listeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    listeners<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="const subscribe = (listener: Listener): (() =&gt; void) =&gt; {
  listeners.add(listener);
  return () =&gt; {
    listeners.delete(listener);
  };
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<h3 id="usesyncexternalstore에-대하여"><a class="anchor" aria-hidden="true" tabindex="-1" href="#usesyncexternalstore에-대하여"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>useSyncExternalStore에 대하여</h3>
<p>React 18에서 Concurrent Rendering이 렌더링을 여러 번에 나누어 처리하기때문에. 첫 번째 컴포넌트를 렌더링하는 중간에 외부 상태가 변경되면, 두 번째 컴포넌트는 이미 변경된 값을 읽게 되는 현상이 발생하는데, 이를 &quot;Tearing&quot;이라고 하고 그를 해소하기 위한 훅으로 <code>useSyncExternalStore</code>를 도입하게 된것을 이해할 수 있었습니다.</p>
<p>원래도 해당 훅을 localStorage와 같은 외부 훅과 동기화 하기 위해서 사용했었는데 내가 잘 모르고 사용하고 있었구나 하는 생각을 했던 것 같습니다.</p>
<h2 id="자랑하고-싶은-코드"><a class="anchor" aria-hidden="true" tabindex="-1" href="#자랑하고-싶은-코드"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>자랑하고 싶은 코드</h2>
<h3 id="createstorage의-동기화-문제-해결-f0d190feaba043b8756fc484b483"><a class="anchor" aria-hidden="true" tabindex="-1" href="#createstorage의-동기화-문제-해결-f0d190feaba043b8756fc484b483"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>createStorage의 동기화 문제 해결 <a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13/commits/f0d190ff4efb2a8e94c27702679b53a53b171d8d">f0d190f</a>,<a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13/commits/eaba043c4e12e74de23b58832e0d74b0c1e90d76">eaba043</a>,<a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13/commits/b8756fca06747f1da6c552b02f71bb3fc27aa079">b8756fc</a>,<a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13/commits/484b483ae794837ec30b2d364cf464c80c338879">484b483</a></h3>
<p>이번 과제에서 가장 도전적이었던 부분은 <code>createStorage</code>의 <code>localStorage</code> 동기화 문제를 해결하는 것이었습니다.</p>
<h4 id="as-is-observer-패턴만-사용"><a class="anchor" aria-hidden="true" tabindex="-1" href="#as-is-observer-패턴만-사용"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>AS-IS: Observer 패턴만 사용</h4>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> createStorage <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> storage <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">let</span> data<span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> subscribe<span class="token punctuation">,</span> notify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">;</span>  <span class="token comment">// 메모리 변수만 반환</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    data <span class="token operator">=</span> value<span class="token punctuation">;</span>  <span class="token comment">// 메모리 변수 업데이트</span>
</span><span class="code-line">    storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 구독자들에게 알림</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> get<span class="token punctuation">,</span> set<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> subscribe <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="export const createStorage = &lt;T&gt;(key: string, storage = window.localStorage) =&gt; {
  let data: T | null = JSON.parse(storage.getItem(key) ?? &quot;null&quot;);
  const { subscribe, notify } = createObserver();

  const get = () =&gt; data;  // 메모리 변수만 반환

  const set = (value: T) =&gt; {
    data = value;  // 메모리 변수 업데이트
    storage.setItem(key, JSON.stringify(data));
    notify();  // 구독자들에게 알림
  };

  return { get, set, reset, subscribe };
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>처음에는 이렇게 간단하게 접근했습니다. Observer 패턴을 사용해서 상태 변화를 구독자들에게 알리고, 메모리 변수로 빠른 접근을 보장하는 구조였습니다. 하지만 이렇게 해보니 테스트 통과는 하지만 조금 찝찝한 부분이 있었습니다.</p>
<p>localStorage를 직접 조작하는 상황들을 생각해보니 다음 상황이 발생할것이라고 생각했습니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// 다른 탭에서 변경하는 시나리오</span>
</span><span class="code-line"><span class="token comment">// 탭 A</span>
</span><span class="code-line"><span class="token keyword">const</span> userStorage <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createStorage</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userStorage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { name: &#x27;John&#x27; }</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 탭 B에서 직접 조작</span>
</span><span class="code-line">localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#x27;Jane&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 탭 A에서 다시 호출</span>
</span><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userStorage<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 여전히 { name: &#x27;John&#x27; }</span>
</span></code><div class="copied" data-code="// 다른 탭에서 변경하는 시나리오
// 탭 A
const userStorage = createStorage&lt;User&gt;(&#x27;user&#x27;);
console.log(userStorage.get()); // { name: &#x27;John&#x27; }

// 탭 B에서 직접 조작
localStorage.setItem(&#x27;user&#x27;, JSON.stringify({ name: &#x27;Jane&#x27; }));

// 탭 A에서 다시 호출
console.log(userStorage.get()); // 여전히 { name: &#x27;John&#x27; }
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>일단 첫번째로는 <code>createStorage</code>가 반환하는 인스턴스가 싱글턴이 아니기때문에 같은 key로 생성된 스토리지 인스턴스임에도 동기화 되지 않을 것이었습니다. 그럼에도 테스트가 통과한 이유는...</p>
<p>현재 테스트는</p>
<pre><code class="language-test code-highlight"><span class="code-line">
</span><span class="code-line">    it(&quot;multiple 컴포넌트가 같은 storage를 구독할 때 동기화되어야 한다&quot;, () =&gt; {
</span><span class="code-line">      const storage = createStorage(&quot;shared&quot;);   // 하나의 인스턴스만 생성
</span><span class="code-line">
</span><span class="code-line">      const { result: result1 } = renderHook(() =&gt; useStorage(storage));
</span><span class="code-line">      const { result: result2 } = renderHook(() =&gt; useStorage(storage));
</span><span class="code-line">
</span><span class="code-line">     /** 후략 */
</span><span class="code-line">    });
</span></code><div class="copied" data-code="
    it(&quot;multiple 컴포넌트가 같은 storage를 구독할 때 동기화되어야 한다&quot;, () =&gt; {
      const storage = createStorage(&quot;shared&quot;);   // 하나의 인스턴스만 생성

      const { result: result1 } = renderHook(() =&gt; useStorage(storage));
      const { result: result2 } = renderHook(() =&gt; useStorage(storage));

     /** 후략 */
    });
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>와 같이 구현되어 있어서 의도적으로 하나의 인스턴스를 공유하고 있어 테스트가 통과되었습니다.</p>
<p>실제로는 제 코드를 기반으로 한다면 각 컴포넌트가 서로 다른 인스턴스를 사용하게 되었을 것입니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// ComponentA.tsx</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">ComponentA</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> userStorage <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createStorage</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 인스턴스 1</span>
</span><span class="code-line">  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useStorage</span><span class="token punctuation">(</span>userStorage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token comment">// ...</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// ComponentB.tsx  </span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">ComponentB</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> userStorage <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createStorage</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 인스턴스 2 </span>
</span><span class="code-line">  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useStorage</span><span class="token punctuation">(</span>userStorage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token comment">// ...</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="// ComponentA.tsx
const ComponentA = () =&gt; {
  const userStorage = createStorage&lt;User&gt;(&#x27;user&#x27;);  // 인스턴스 1
  const user = useStorage(userStorage);
  // ...
};

// ComponentB.tsx  
const ComponentB = () =&gt; {
  const userStorage = createStorage&lt;User&gt;(&#x27;user&#x27;);  // 인스턴스 2 
  const user = useStorage(userStorage);
  // ...
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>그렇게 되면 인스턴스 1이 구독하는 observer와 인스턴스 2가 구독하는 observer가 완전히 별개가 되어버려서, <code>ComponentA</code>에서 <code>userStorage.set()</code>을 호출해도 <code>ComponentB</code>의 <code>useStorage</code> 훅은 변경 사실을 전혀 모르게 될 거라고 예상했습니다.</p>
<img width="802" height="670" alt="image" src="https://github.com/user-attachments/assets/2766aaf5-3881-47bb-9cba-41dc5449729e"/>
<img width="137" height="82" alt="image" src="https://github.com/user-attachments/assets/d5994825-7bf7-4090-801c-16aa96aedbd8"/>
<p>(그렇게 시작된 대화...<del>두컷만화</del>)</p>
<h4 id="내-코드의-문제가-뭘까"><a class="anchor" aria-hidden="true" tabindex="-1" href="#내-코드의-문제가-뭘까"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>내 코드의 문제가 뭘까</h4>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> createStorage <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> storage <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">let</span> data<span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 각각 다른 data 변수, 게다가 초기화 시점에만 읽음</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> subscribe<span class="token punctuation">,</span> notify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 각각 다른 observer</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    data <span class="token operator">=</span> value<span class="token punctuation">;</span>  <span class="token comment">// 인스턴스 1의 data만 업데이트</span>
</span><span class="code-line">    storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 인스턴스 1의 구독자들에게만 알림</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> get<span class="token punctuation">,</span> set<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> subscribe <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="export const createStorage = &lt;T&gt;(key: string, storage = window.localStorage) =&gt; {
  let data: T | null = JSON.parse(storage.getItem(key) ?? &quot;null&quot;);  // 각각 다른 data 변수, 게다가 초기화 시점에만 읽음
  const { subscribe, notify } = createObserver();  // 각각 다른 observer
  
  const set = (value: T) =&gt; {
    data = value;  // 인스턴스 1의 data만 업데이트
    storage.setItem(key, JSON.stringify(data));
    notify();  // 인스턴스 1의 구독자들에게만 알림
  };
  
  return { get, set, reset, subscribe };
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>처음의 코드에서는 같은 키 &#x27;user&#x27;로 createStorage를 여러 번 호출하면 각각 다른 data 변수, 각각 다른 observer 인스턴스, 각각 다른 구독자 목록을 가지게 되므로 결과적으로 ComponentA에서 상태를 변경해도 ComponentB는 전혀 알 수 없는 상황이 발생합니다.</p>
<p>또한 초기화 시점에 한 번만 localStorage를 읽고, 그 이후로는 메모리 변수만 반환하다 보니 외부 변경사항을 전혀 감지할 수 없었습니다.
게다가 객체 타입의 데이터를 다룰 때 매번 새로운 객체가 생성되어 <code>useSyncExternalStore</code>가 불필요한 리렌더링을 계속 발생시킬것으로 예상했습니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// AS-IS에서 객체 반환 시 문제</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">;</span>  <span class="token comment">// data가 객체면?</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> userStorage <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createStorage</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">userStorage<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#x27;John&#x27;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">return</span> <span class="token function">useSyncExternalStore</span><span class="token punctuation">(</span>storage<span class="token punctuation">.</span>subscribe<span class="token punctuation">,</span> storage<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="// AS-IS에서 객체 반환 시 문제
const get = () =&gt; data;  // data가 객체면?

const userStorage = createStorage&lt;User&gt;(&#x27;user&#x27;);
userStorage.set({ name: &#x27;John&#x27;, age: 30 });

return useSyncExternalStore(storage.subscribe, storage.get);
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>useSyncExternalStore는 참조 비교로 변경을 감지하는데 JSON.parse는 매번 새로운 객체를 생성하므로</p>
<ol>
<li>useSyncExternalStore가 값이 변경되었다고 판단함</li>
<li>리렌더링 발생</li>
<li>다시 get() 호출</li>
<li>또 다른 새로운 객체 반환
.... 무한순환해버림
요 과정이 무한루프를 돌것으로 예상되었습니다.</li>
</ol>
<h4 id="to-be-싱글톤-패턴--캐시-시스템"><a class="anchor" aria-hidden="true" tabindex="-1" href="#to-be-싱글톤-패턴--캐시-시스템"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>TO-BE: 싱글톤 패턴 + 캐시 시스템</h4>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">StorageInstance<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token function-variable function">listener</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 싱글톤 맵</span>
</span><span class="code-line"><span class="token keyword">const</span> storageInstances <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> StorageInstance<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> createStorage <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> storage <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">)</span><span class="token operator">:</span> StorageInstance<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// 이미 존재하면 기존 인스턴스 반환</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>storageInstances<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> storageInstances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token keyword">as</span> StorageInstance<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> subscribe<span class="token punctuation">,</span> notify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// 캐시로 참조 안정성 보장</span>
</span><span class="code-line">  <span class="token keyword">let</span> cachedValue<span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">let</span> isInitialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> get <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> item <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      cachedValue <span class="token operator">=</span> item <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">      isInitialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">return</span> cachedValue<span class="token punctuation">;</span>  <span class="token comment">// 항상 같은 참조 반환</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    cachedValue <span class="token operator">=</span> value<span class="token punctuation">;</span>  <span class="token comment">// 캐시 즉시 업데이트</span>
</span><span class="code-line">    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span> get<span class="token punctuation">,</span> set<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> subscribe <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">  storageInstances<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 싱글톤 저장</span>
</span><span class="code-line">  <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="interface StorageInstance&lt;T&gt; {
  get(): T | null;
  set(value: T): void;
  reset(): void;
  subscribe(listener: () =&gt; void): () =&gt; void;
}

// 싱글톤 맵
const storageInstances = new Map&lt;string, StorageInstance&lt;unknown&gt;&gt;();

export const createStorage = &lt;T&gt;(key: string, storage = window.localStorage): StorageInstance&lt;T&gt; =&gt; {
  // 이미 존재하면 기존 인스턴스 반환
  if (storageInstances.has(key)) {
    return storageInstances.get(key) as StorageInstance&lt;T&gt;;
  }

  const { subscribe, notify } = createObserver();

  // 캐시로 참조 안정성 보장
  let cachedValue: T | null = null;
  let isInitialized = false;

  const get = (): T | null =&gt; {
    if (!isInitialized) {
      const item = storage.getItem(key);
      cachedValue = item ? JSON.parse(item) : null;
      isInitialized = true;
    }
    return cachedValue;  // 항상 같은 참조 반환
  };

  const set = (value: T) =&gt; {
    storage.setItem(key, JSON.stringify(value));
    cachedValue = value;  // 캐시 즉시 업데이트
    notify();
  };

  const instance = { get, set, reset, subscribe };
  storageInstances.set(key, instance);  // 싱글톤 저장
  return instance;
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>위 코드에서는 싱글톤 맵을 생성하여 같은 키로 <code>createStorage</code>를 호출하게 되면 완전히 동일한 인스턴스를 받게 구현하였습니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">const</span> get <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// 실제 사용 시점에 localStorage 확인</span>
</span><span class="code-line">    <span class="token keyword">const</span> item <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    cachedValue <span class="token operator">=</span> item <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">    isInitialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword">return</span> cachedValue<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="const get = (): T | null =&gt; {
  if (!isInitialized) {
    // 실제 사용 시점에 localStorage 확인
    const item = storage.getItem(key);
    cachedValue = item ? JSON.parse(item) : null;
    isInitialized = true;
  }
  return cachedValue;
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>또한 지연로딩을 통해 첫번째 호출인 경우에만 localStorage를 읽도록하여 외부 변경 감지를 돕도록 구현하였습니다.</p>
<p>이렇게 해두고 <a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13/commits/eaba043c4e12e74de23b58832e0d74b0c1e90d76">추가적인 테스트</a>를 작성하였습니다.</p>
<img width="442" height="64" alt="image" src="https://github.com/user-attachments/assets/159732ca-0c1d-4ccb-b169-ab24cb406381"/>
<p>이 두 테스트는 싱글톤 패턴이 올바르게 구현되었는지를 테스트하기 위해 작성하였는데요,</p>
<p>첫 번째 테스트 &quot;같은 key로 생성된 다른 인스턴스들이 동기화되어야 한다&quot;는 싱글톤의 핵심 기능을 검증합니다. 실제로는 각 컴포넌트가 독립적으로 <code>createStorage(&quot;user&quot;)</code>를 호출하는 경우가 대부분인데, 이때 같은 key를 사용하는 모든 호출이 실제로는 동일한 인스턴스를 반환해야 합니다. 만약 싱글톤 패턴이 제대로 구현되지 않았다면, storage1.set()으로 값을 변경해도 storage2를 구독하는 컴포넌트는 변경 사실을 전혀 모르게 되어 UI가 동기화되지 않는 문제가 발생하기 때문에 이런 문제를 테스트하기 위해 작성하였습니다.</p>
<p>또한 두 번째 테스트 &quot;다른 key들은 서로 독립적으로 동작해야 한다&quot;는 네임스페이스 격리를 검증합니다. 싱글톤 패턴을 구현할 때 자칫하면 모든 key가 하나의 인스턴스를 공유하거나, 한 key의 변경이 다른 key에 영향을 줄 수 있습니다. 때문에 사용자 정보(&quot;user&quot;)를 변경했을 때 테마 설정(&quot;settings&quot;)이 영향받지 않는지, 그리고 각 key별로 완전히 독립적인 상태 관리가 이루어지는지를 확인하도록 작성하였습니다.</p>
<h4 id="그런데도-해결되지-않는-찝찝함"><a class="anchor" aria-hidden="true" tabindex="-1" href="#그런데도-해결되지-않는-찝찝함"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>그런데도 해결되지 않는 찝찝함...🥹</h4>
<p>사실 어느정도 수준에서는 해결이 되었다고 생각했습니다. 그러나 외부에서 직접 localStorage를 조작하는 경우는 감지할 수 없었습니다.
<del>(아 물론 조작안하면 되긴 하는데...찝찝하잖아)</del></p>
<p>이미 저는 로컬스토리지의 커스텀 이벤트를 알아버렸기 때문에...해당 방식을 가져와서 사용하기로 마음먹게 됩니다...
여기서 핵심은 이중 이벤트 감지라고 할 수 있는데요. storage 이벤트를 통해서는 다른 탭에서 변경을 감지하고, 커스텀 이벤트인 storage-inner-document 이벤트로는 같은 탭에서의 변경을 감지하는 방식입니다. <a href="https://blog.shiren.dev/ko/post/2023-04-18">성호코치님 글 참고</a></p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// 같은 탭에서의 변경을 감지하기 위한 커스텀 이벤트</span>
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">StorageInnerDocumentEvent</span> <span class="token keyword">extends</span> <span class="token class-name">CustomEvent<span class="token operator">&lt;</span>StorageEventDetail<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">static</span> <span class="token keyword">readonly</span> eventName <span class="token operator">=</span> <span class="token string">&quot;storage-inner-document&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token function">constructor</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> oldValue<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> newValue<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">super</span><span class="token punctuation">(</span>StorageInnerDocumentEvent<span class="token punctuation">.</span>eventName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">      detail<span class="token operator">:</span> <span class="token punctuation">{</span> key<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 글로벌 이벤트 핸들러</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">handleStorageEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> Event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">let</span> targetKey<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">StorageEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// 다른 탭에서의 변경 (브라우저 기본 storage 이벤트)</span>
</span><span class="code-line">    targetKey <span class="token operator">=</span> event<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;storage-inner-document&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// 같은 탭에서의 변경 (커스텀 이벤트)</span>
</span><span class="code-line">    targetKey <span class="token operator">=</span> <span class="token punctuation">(</span>event <span class="token keyword">as</span> CustomEvent<span class="token operator">&lt;</span>StorageEventDetail<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>detail<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>targetKey <span class="token operator">&amp;&amp;</span> globalObservers<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>targetKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">//  캐시 무효화해서 다음 get() 호출 시 localStorage 재확인</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheInvalidators<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>targetKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      cacheInvalidators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetKey<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    
</span><span class="code-line">    globalObservers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetKey<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="// 같은 탭에서의 변경을 감지하기 위한 커스텀 이벤트
class StorageInnerDocumentEvent extends CustomEvent&lt;StorageEventDetail&gt; {
  static readonly eventName = &quot;storage-inner-document&quot;;
  
  constructor(key: string, oldValue: string | null, newValue: string | null) {
    super(StorageInnerDocumentEvent.eventName, {
      detail: { key, oldValue, newValue },
    });
  }
}

// 글로벌 이벤트 핸들러
const handleStorageEvent = (event: Event) =&gt; {
  let targetKey: string | null = null;

  if (event instanceof StorageEvent) {
    // 다른 탭에서의 변경 (브라우저 기본 storage 이벤트)
    targetKey = event.key;
  } else if (event.type === &quot;storage-inner-document&quot;) {
    // 같은 탭에서의 변경 (커스텀 이벤트)
    targetKey = (event as CustomEvent&lt;StorageEventDetail&gt;).detail.key;
  }

  if (targetKey &amp;&amp; globalObservers.has(targetKey)) {
    //  캐시 무효화해서 다음 get() 호출 시 localStorage 재확인
    if (cacheInvalidators.has(targetKey)) {
      cacheInvalidators.get(targetKey)!();
    }
    
    globalObservers.get(targetKey)!.notify();
  }
};
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>그리고 이벤트가 발생하면 해당 키의 캐시를 무효화시켜서, 다음 get() 호출 시에는 localStorage를 다시 읽도록 했습니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">invalidateCache</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  isInitialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// 다음 get() 호출 시 localStorage 재확인</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">cacheInvalidators<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> invalidateCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="const invalidateCache = () =&gt; {
  isInitialized = false;  // 다음 get() 호출 시 localStorage 재확인
};

cacheInvalidators.set(key, invalidateCache);
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>실제 시나리오는 다음과 같을것이라고 생각합니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// 컴포넌트 A</span>
</span><span class="code-line"><span class="token keyword">const</span> userStorage <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createStorage</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useStorage</span><span class="token punctuation">(</span>userStorage<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// { name: &#x27;John&#x27; }</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 컴포넌트 B (같은 탭)</span>
</span><span class="code-line"><span class="token keyword">const</span> userStorage2 <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createStorage</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 동일한 인스턴스!</span>
</span><span class="code-line">userStorage2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#x27;Jane&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 실시간 동기화 과정:</span>
</span><span class="code-line"><span class="token comment">// 1. localStorage.setItem(&#x27;user&#x27;, &#x27;{&quot;name&quot;:&quot;Jane&quot;}&#x27;)</span>
</span><span class="code-line"><span class="token comment">// 2. StorageInnerDocumentEvent 발생</span>
</span><span class="code-line"><span class="token comment">// 3. handleStorageEvent 실행</span>
</span><span class="code-line"><span class="token comment">// 4. 캐시 무효화 (isInitialized = false)</span>
</span><span class="code-line"><span class="token comment">// 5. 모든 구독자에게 notify()</span>
</span><span class="code-line"><span class="token comment">// 6. 컴포넌트 A 자동 리렌더링 → user = { name: &#x27;Jane&#x27; }</span>
</span></code><div class="copied" data-code="// 컴포넌트 A
const userStorage = createStorage&lt;User&gt;(&#x27;user&#x27;);
const user = useStorage(userStorage);  // { name: &#x27;John&#x27; }

// 컴포넌트 B (같은 탭)
const userStorage2 = createStorage&lt;User&gt;(&#x27;user&#x27;);  // 동일한 인스턴스!
userStorage2.set({ name: &#x27;Jane&#x27; });

// 실시간 동기화 과정:
// 1. localStorage.setItem(&#x27;user&#x27;, &#x27;{&quot;name&quot;:&quot;Jane&quot;}&#x27;)
// 2. StorageInnerDocumentEvent 발생
// 3. handleStorageEvent 실행
// 4. 캐시 무효화 (isInitialized = false)
// 5. 모든 구독자에게 notify()
// 6. 컴포넌트 A 자동 리렌더링 → user = { name: &#x27;Jane&#x27; }
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>계속 만약에 게임을 하면서 시나리오를 그려가는 기분이 들고 재밌었습니다.
<img width="362" height="275" alt="image" src="https://github.com/user-attachments/assets/1e3c04b6-bd99-4931-b8bc-bdd53cfc0f39"/></p>
<p><em>블로커로 작용했던 질문이라 지송..</em></p>
<h3 id="useeffect-구현-0636fa7-517e7f6"><a class="anchor" aria-hidden="true" tabindex="-1" href="#useeffect-구현-0636fa7-517e7f6"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>useEffect 구현 <a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13/commits/0636fa75945c9f1ba9c855bf17374bd327fb454d">0636fa7</a>, <a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13/commits/517e7f6c41e4789b00cef8d48ba5bc0210a1b545">517e7f6</a></h3>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">type <span class="token function-variable function"><span class="token maybe-class-name">EffectCallback</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">effect</span><span class="token operator">:</span> <span class="token maybe-class-name">EffectCallback</span><span class="token punctuation">,</span> deps<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">DependencyList</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> prevDepsRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span><span class="token maybe-class-name">DependencyList</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> cleanupRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> isFirstRenderRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> depsChanged <span class="token operator">=</span>
</span><span class="code-line">    deps <span class="token operator">===</span> <span class="token keyword nil">undefined</span> <span class="token operator">||</span> prevDepsRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">===</span> <span class="token keyword nil">undefined</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">shallowEquals</span><span class="token punctuation">(</span>prevDepsRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">,</span> deps<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isFirstRenderRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">||</span> depsChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>cleanupRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> cleanupRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      cleanupRef<span class="token punctuation">.</span><span class="token method function property-access">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> cleanup <span class="token operator">=</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    cleanupRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> cleanup<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    prevDepsRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> deps<span class="token punctuation">;</span>
</span><span class="code-line">    isFirstRenderRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="type EffectCallback = () =&gt; void | (() =&gt; void);

export function useEffect(effect: EffectCallback, deps?: DependencyList): void {
  const prevDepsRef = useRef&lt;DependencyList | undefined&gt;(undefined);
  const cleanupRef = useRef&lt;(() =&gt; void) | void&gt;(undefined);
  const isFirstRenderRef = useRef&lt;boolean&gt;(true);

  const depsChanged =
    deps === undefined || prevDepsRef.current === undefined || !shallowEquals(prevDepsRef.current, deps);

  if (isFirstRenderRef.current || depsChanged) {
    if (cleanupRef.current &amp;&amp; typeof cleanupRef.current === &quot;function&quot;) {
      cleanupRef.current();
    }

    const cleanup = effect();
    cleanupRef.current = cleanup;

    prevDepsRef.current = deps;
    isFirstRenderRef.current = false;
  }
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>사실 <code>useEffect</code>같은 경우에 구현이 어려울 것 같지 않아서 추가적으로 구현해봤습니다.
<code>prevDepsRef</code>를 통해 이전 의존성을 저장하고, <code>cleanupRef</code>로 정리 함수를 관리하며 <code>isFirstRenderRef</code>로 첫 렌더링인지를 추적하도록 구현하였습니다.</p>
<p>또한 의존성 관련해서도 deps가 undefined면 매번 실행하고, 첫 실행이거나 shallowEquals로 의존성이 변경되었을 때만 effect를 실행하도록 구현하였습니다.</p>
<h2 id="개선이-필요하다고-생각하는-코드"><a class="anchor" aria-hidden="true" tabindex="-1" href="#개선이-필요하다고-생각하는-코드"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>개선이 필요하다고 생각하는 코드</h2>
<p>제가 추가적으로 작성한 createStorage 코드를 개선할 수 있으면 해보고 싶은데...뭔가 아이디어가 떠오르진 않는것 같습니다.
사실 createObserver를 제거해도 될 것 같은데, 현재의 구독형태를 그대로 가져가고 싶어서 createObserver를 제거하지 않고 하이브리드 형태로 구현하였습니다.</p>
<details>
<summary>createStorage 코드</summary>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createObserver <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./createObserver.ts&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">StorageInstance<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token function-variable function">listener</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">StorageEventDetail</span> <span class="token punctuation">{</span>
</span><span class="code-line">  key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</span><span class="code-line">  oldValue<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">  newValue<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">StorageInnerDocumentEvent</span> <span class="token keyword">extends</span> <span class="token class-name">CustomEvent<span class="token operator">&lt;</span>StorageEventDetail<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">static</span> <span class="token keyword">readonly</span> eventName <span class="token operator">=</span> <span class="token string">&quot;storage-inner-document&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">constructor</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> oldValue<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> newValue<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">super</span><span class="token punctuation">(</span>StorageInnerDocumentEvent<span class="token punctuation">.</span>eventName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">      detail<span class="token operator">:</span> <span class="token punctuation">{</span> key<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> globalObservers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> createObserver<span class="token operator">&gt;&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> cacheInvalidators <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span> <span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">handleStorageEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> Event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">let</span> targetKey<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">StorageEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    targetKey <span class="token operator">=</span> event<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;storage-inner-document&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    targetKey <span class="token operator">=</span> <span class="token punctuation">(</span>event <span class="token keyword">as</span> CustomEvent<span class="token operator">&lt;</span>StorageEventDetail<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>detail<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>targetKey <span class="token operator">&amp;&amp;</span> globalObservers<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>targetKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheInvalidators<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>targetKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      cacheInvalidators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetKey<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    globalObservers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetKey<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">let</span> globalListenersRegistered <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function-variable function">getGlobalObserver</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>globalObservers<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    globalObservers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">createObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>globalListenersRegistered<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span> handleStorageEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>StorageInnerDocumentEvent<span class="token punctuation">.</span>eventName<span class="token punctuation">,</span> handleStorageEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      globalListenersRegistered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> globalObservers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> storageInstances <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> StorageInstance<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> createStorage <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> storage <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">)</span><span class="token operator">:</span> StorageInstance<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>storageInstances<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> storageInstances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token keyword">as</span> StorageInstance<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> globalObserver <span class="token operator">=</span> <span class="token function">getGlobalObserver</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">let</span> cachedValue<span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">let</span> isInitialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">invalidateCache</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    isInitialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  cacheInvalidators<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> invalidateCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> get <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">const</span> item <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        cachedValue <span class="token operator">=</span> item <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">        isInitialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error parsing storage item for key &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        cachedValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">        isInitialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">return</span> cachedValue<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> oldValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token keyword">const</span> newValue <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      cachedValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StorageInnerDocumentEvent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error setting storage item for key &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> oldValue <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      storage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      cachedValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StorageInnerDocumentEvent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error removing storage item for key &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> subscribe <span class="token operator">=</span> globalObserver<span class="token punctuation">.</span>subscribe<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span> get<span class="token punctuation">,</span> set<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> subscribe <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  storageInstances<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span></code><div class="copied" data-code="import { createObserver } from &quot;./createObserver.ts&quot;;

interface StorageInstance&lt;T&gt; {
  get(): T | null;
  set(value: T): void;
  reset(): void;
  subscribe(listener: () =&gt; void): () =&gt; void;
}

interface StorageEventDetail {
  key: string;
  oldValue: string | null;
  newValue: string | null;
}

class StorageInnerDocumentEvent extends CustomEvent&lt;StorageEventDetail&gt; {
  static readonly eventName = &quot;storage-inner-document&quot;;

  constructor(key: string, oldValue: string | null, newValue: string | null) {
    super(StorageInnerDocumentEvent.eventName, {
      detail: { key, oldValue, newValue },
    });
  }
}

const globalObservers = new Map&lt;string, ReturnType&lt;typeof createObserver&gt;&gt;();

const cacheInvalidators = new Map&lt;string, () =&gt; void&gt;();

const handleStorageEvent = (event: Event) =&gt; {
  let targetKey: string | null = null;

  if (event instanceof StorageEvent) {
    targetKey = event.key;
  } else if (event.type === &quot;storage-inner-document&quot;) {
    targetKey = (event as CustomEvent&lt;StorageEventDetail&gt;).detail.key;
  }

  if (targetKey &amp;&amp; globalObservers.has(targetKey)) {
    if (cacheInvalidators.has(targetKey)) {
      cacheInvalidators.get(targetKey)!();
    }

    globalObservers.get(targetKey)!.notify();
  }
};

let globalListenersRegistered = false;

const getGlobalObserver = (key: string) =&gt; {
  if (!globalObservers.has(key)) {
    globalObservers.set(key, createObserver());

    if (!globalListenersRegistered) {
      window.addEventListener(&quot;storage&quot;, handleStorageEvent);
      window.addEventListener(StorageInnerDocumentEvent.eventName, handleStorageEvent);
      globalListenersRegistered = true;
    }
  }

  return globalObservers.get(key)!;
};

const storageInstances = new Map&lt;string, StorageInstance&lt;unknown&gt;&gt;();

export const createStorage = &lt;T&gt;(key: string, storage = window.localStorage): StorageInstance&lt;T&gt; =&gt; {
  if (storageInstances.has(key)) {
    return storageInstances.get(key) as StorageInstance&lt;T&gt;;
  }

  const globalObserver = getGlobalObserver(key);

  let cachedValue: T | null = null;
  let isInitialized = false;

  const invalidateCache = () =&gt; {
    isInitialized = false;
  };

  cacheInvalidators.set(key, invalidateCache);

  const get = (): T | null =&gt; {
    if (!isInitialized) {
      try {
        const item = storage.getItem(key);
        cachedValue = item ? JSON.parse(item) : null;
        isInitialized = true;
      } catch (error) {
        console.error(`Error parsing storage item for key &quot;${key}&quot;:`, error);
        cachedValue = null;
        isInitialized = true;
      }
    }
    return cachedValue;
  };

  const set = (value: T) =&gt; {
    try {
      const oldValue = storage.getItem(key);
      const newValue = JSON.stringify(value);

      storage.setItem(key, newValue);

      cachedValue = value;

      window.dispatchEvent(new StorageInnerDocumentEvent(key, oldValue, newValue));
    } catch (error) {
      console.error(`Error setting storage item for key &quot;${key}&quot;:`, error);
    }
  };

  const reset = () =&gt; {
    try {
      const oldValue = storage.getItem(key);
      storage.removeItem(key);

      cachedValue = null;

      window.dispatchEvent(new StorageInnerDocumentEvent(key, oldValue, null));
    } catch (error) {
      console.error(`Error removing storage item for key &quot;${key}&quot;:`, error);
    }
  };

  const subscribe = globalObserver.subscribe;

  const instance = { get, set, reset, subscribe };

  storageInstances.set(key, instance);

  return instance;
};

"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
</details>
<h2 id="학습-효과-분석"><a class="anchor" aria-hidden="true" tabindex="-1" href="#학습-효과-분석"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>학습 효과 분석</h2>
<p><strong>가장 큰 배움</strong>: React의 성능 최적화가 단순히 memo나 useMemo를 사용하는 것이 아니라, <strong>데이터 흐름과 리렌더링 트리거를 정확히 이해</strong>하고 적절한 지점에 적용하는 것임을 깨달았습니다. 특히 useShallowSelector에서 상태 비교가 아닌 결과 비교로 수정한 경험이 인상 깊었습니다.</p>
<p><strong>추가 학습 필요 영역</strong>: 현재 구현한 훅들은 기본적인 메모이제이션에 집중되어 있는데, Concurrent Features와 관련된 고급 최적화 기법들을 더 학습하고 싶습니다.</p>
<p><strong>실무 적용 가능성</strong>: Context 분리 패턴과 selector 기반 상태 구독은 실제 프로젝트에서 바로 적용할 수 있을 것 같습니다.</p>
<h2 id="과제-피드백"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-피드백"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 피드백</h2>
<p>과제 자체가 어려운편이 아니라 스스로 학습을 하기 위한 동기 부여가 필요하지 않을까? 생각했습니다.</p>
<h1 id="학습-갈무리"><a class="anchor" aria-hidden="true" tabindex="-1" href="#학습-갈무리"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>학습 갈무리</h1>
<h2 id="리액트의-렌더링이-어떻게-이루어지는지-정리해주세요"><a class="anchor" aria-hidden="true" tabindex="-1" href="#리액트의-렌더링이-어떻게-이루어지는지-정리해주세요"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>리액트의 렌더링이 어떻게 이루어지는지 정리해주세요.</h2>
<p>이전까지는 Fiber 아키텍쳐에 대해서 공부하기 싫어서 흐린눈하다가...이번 기회로 좀 해보자..! 싶어서 아주 얕게나마 공부해 보았습니다...</p>
<p>리액트 렌더링은 React 16에서 도입된  React Fiber를 통해 설명할 수 있을 것 같습니다. 동기식 스택 기반 렌더링에서 비동기적이고 중단 가능한 렌더링으로의 패러다임 전환을 가능하게 했습니다. React Fiber는 우선순위 기반 업데이트 처리를 통해 향상된 사용자 경험을 제공합니다.</p>
<p>React 15까지 사용된 Stack Reconciler는 문제가 있었습니다. <a href="https://legacy.reactjs.org/docs/implementation-notes.html#future-directions">리액트 공식문서</a>에서도 언급되는 내용인데,</p>
<blockquote>
<p>Stack reconciler has inherent limitations such as being synchronous and unable to interrupt the work or split it in chunks
Stack reconciler는 동기적이며 작업을 중단하거나 이를 여러 조각으로 나눌 수 없다는 한계를 가지고 있습니다.</p>
</blockquote>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// Stack Reconciler의 문제점을 보여주는 예시</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">heavyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// 1000개의 아이템을 렌더링한다고 가정</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token known-class-name class-name">Array</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComplexItem</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span> <span class="token attr-name">data</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">complexCalculation</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line">      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="// Stack Reconciler의 문제점을 보여주는 예시
function heavyComponent() {
  // 1000개의 아이템을 렌더링한다고 가정
  return (
    &lt;div&gt;
      {Array(1000).fill(0).map((_, i) =&gt; (
        &lt;ComplexItem key={i} data={complexCalculation(i)} /&gt;
      ))}
    &lt;/div&gt;
  );
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>여기서 complexCalculation이 엄청나게 무겁다고 하겠습니다. 이때 Stack Reconciler는 1000개를 모두 처리할 때까지 메인 스레드를 점유했습니다. 그 사이 사용자가 버튼을 클릭하거나 입력을 해도 반응하지 않았습니다.</p>
<p>또한 호출 스택에 의존성을 두고 있어 컨텍스트를 잃지 않고는 작업을 일시정지 할 수 없고, 한 번의 패스로 전체 트리를 순회해야 했습니다. 게다가 모든 업데이트를 동일한 중요도로 처리하고 있어 긴급도에 따라 작업 처리를 할 수 없었습니다.</p>
<p>이런 문제점을 해소하기 위해 나온 것이 Fiber 아키텍쳐입니다. Fiber은 큰 작업을 작게 나누자! 라는 것을 아이디어로 두고 있습니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token comment">// 간소화된 fiber workloop</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token parameter">isAsync</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span>nextUnitOfWork <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// 작은 단위의 작업 수행</span>
</span><span class="code-line">    nextUnitOfWork <span class="token operator">=</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span>nextUnitOfWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment">// 비동기 모드에서는 시간을 체크</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isAsync <span class="token operator">&amp;&amp;</span> <span class="token function">shouldYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword control-flow">break</span><span class="token punctuation">;</span> <span class="token comment">// 브라우저에게 제어권 양보</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="// 간소화된 fiber workloop
function workLoop(isAsync) {
  while (nextUnitOfWork !== null) {
    // 작은 단위의 작업 수행
    nextUnitOfWork = performUnitOfWork(nextUnitOfWork);
    
    // 비동기 모드에서는 시간을 체크
    if (isAsync &amp;&amp; shouldYield()) {
      break; // 브라우저에게 제어권 양보
    }
  }
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>React는 계속 브라우저에게 우선순위가 높은 일에 대해 물어보게 됩니다. 사용자 입력이나 애니메이션 같은 급한 일이 있는 경우에는 작업을 양보하는 플로우라고 생각하면 될 것 같습니다.</p>
<p>게다가 리액트 기본 단위의 변화도 존재하는데, 기존 React에서는 컴포넌트가 기본 단위였고 Fiber에서는 Fiber Node가 기본 단위가 되었습니다. 이렇게 변경된 이유는 아마 기존의 트리 방식보다 연결 리스트를 통해 처리하는 것이 언제든 멈추고 이어서 동작이 가능하기 때문이 아닐까 생각합니다.</p>
<h3 id="react-렌더링의-전체-과정"><a class="anchor" aria-hidden="true" tabindex="-1" href="#react-렌더링의-전체-과정"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>React 렌더링의 전체 과정</h3>
<p>그렇다면 실제로 React 렌더링은 어떻게 이루어질까요? 크게 3단계로 나눠볼 수 있습니다.
일단 리액트 렌더링은 두 가지 단계로 설명할 수 있습니다.</p>
<h4 id="1-render-phase-reconciliation---중단-가능함"><a class="anchor" aria-hidden="true" tabindex="-1" href="#1-render-phase-reconciliation---중단-가능함"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>1. Render Phase (Reconciliation) -&gt; 중단 가능함</h4>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">function</span> <span class="token function">renderPhase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// 중단 가능한 작업들을 주로함</span>
</span><span class="code-line">  <span class="token comment">// - 컴포넌트 함수 실행</span>
</span><span class="code-line">  <span class="token comment">// - Virtual DOM 생성</span>
</span><span class="code-line">  <span class="token comment">// - 이전 트리와 비교 (diffing)</span>
</span><span class="code-line">  <span class="token comment">// - 변경사항 목록 작성</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token comment">// 절대 하지 않는 일</span>
</span><span class="code-line">  <span class="token comment">// - DOM 조작</span>
</span><span class="code-line">  <span class="token comment">// - 사이드 이펙트 실행</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="function renderPhase() {
  // 중단 가능한 작업들을 주로함
  // - 컴포넌트 함수 실행
  // - Virtual DOM 생성
  // - 이전 트리와 비교 (diffing)
  // - 변경사항 목록 작성
  
  // 절대 하지 않는 일
  // - DOM 조작
  // - 사이드 이펙트 실행
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>Render 단계는 여러 번 실행될 수 있고 중간에 급한 일이 생기면 처음부터 다시 시작할 수 있는 작업들을 수행합니다.</p>
<h4 id="2-commit-phase"><a class="anchor" aria-hidden="true" tabindex="-1" href="#2-commit-phase"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>2. Commit Phase</h4>
<pre><code class="code-highlight"><span class="code-line">function commitPhase() {
</span><span class="code-line">  //  한 번에 모든 변경사항 적용
</span><span class="code-line">  // - DOM 업데이트
</span><span class="code-line">  // - useEffect 실행
</span><span class="code-line">  // - ref 업데이트
</span><span class="code-line">  // - 라이프사이클 메서드 호출
</span><span class="code-line">}
</span></code><div class="copied" data-code="function commitPhase() {
  //  한 번에 모든 변경사항 적용
  // - DOM 업데이트
  // - useEffect 실행
  // - ref 업데이트
  // - 라이프사이클 메서드 호출
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>Commit 단계는 절대 중단되지 않습니다. 이 단계는 또 다시 3개의 하위 단계로 나뉩니다.</p>
<ol>
<li>Before mutation: DOM 변경 전 (getSnapshotBeforeUpdate)</li>
<li>Mutation: 실제 DOM 변경 (요소 추가/제거/수정)</li>
<li>Layout: DOM 변경 후 (useLayoutEffect, componentDidMount)</li>
</ol>
<h4 id="우선순위-시스템과-lane"><a class="anchor" aria-hidden="true" tabindex="-1" href="#우선순위-시스템과-lane"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>우선순위 시스템과 Lane</h4>
<p>그렇다면 Fiber에서는 앞서 말한 &#x27;급한 일&#x27;을 어떻게 처리할까요?
React 18의 <code>Lane 시스템</code>은 우선순위를 비트로 관리합니다. 자세한 내용은 <a href="https://goidle.github.io/react/in-depth-react18-lane/">React 톺아보기</a>블로그를 확인하면 좋을 듯한데, 아무튼 간략하게만 이해해보자면 Lane에는 다음과 같은 종류가 있습니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token comment">// 우선순위 레벨 (숫자가 작을수록 높은 우선순위)</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">SyncLane</span> <span class="token operator">=</span> <span class="token number">0b0000001</span><span class="token punctuation">;</span>           <span class="token comment">// 동기 (가장 급함)</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">InputContinuousLane</span> <span class="token operator">=</span> <span class="token number">0b0000100</span><span class="token punctuation">;</span> <span class="token comment">// 사용자 입력</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">DefaultLane</span> <span class="token operator">=</span> <span class="token number">0b0010000</span><span class="token punctuation">;</span>         <span class="token comment">// 일반 업데이트</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">TransitionLane</span> <span class="token operator">=</span> <span class="token number">0b1000000</span><span class="token punctuation">;</span>      <span class="token comment">// 화면 전환</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">IdleLane</span> <span class="token operator">=</span> <span class="token number">0b100000000000000</span><span class="token punctuation">;</span>    <span class="token comment">// 한가할 때</span>
</span></code><div class="copied" data-code="// 우선순위 레벨 (숫자가 작을수록 높은 우선순위)
const SyncLane = 0b0000001;           // 동기 (가장 급함)
const InputContinuousLane = 0b0000100; // 사용자 입력
const DefaultLane = 0b0010000;         // 일반 업데이트
const TransitionLane = 0b1000000;      // 화면 전환
const IdleLane = 0b100000000000000;    // 한가할 때
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>이때 위처럼 비트마스크를 통해 우선순위를 비교한다고 생각하면 될 것 같습니다.</p>
<p>리액트에서 업데이트가 발생하면 업데이트의 종류에 따라 Lane을 할당합니다. Reconciler는 이때 Lane들을 들고 있고, 해당 Lane 위의 업데이트들을 배치처리하게 됩니다.</p>
<p>이런 Lane들이 가지고 있는 각각의 우선순위들에 따라 업데이트를 실행하는데</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// 사용자가 입력창에 타이핑 중</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SearchInput</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">,</span> setResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> 
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token script language-javascript">          <span class="token comment">// 고우선순위: 즉시 처리</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token script language-javascript">          <span class="token function">setQuery</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token script language-javascript">          
</span></span></span><span class="code-line"><span class="token tag"><span class="token script language-javascript">          <span class="token comment">// 저우선순위: 나중에 처리</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token script language-javascript">          <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token script language-javascript">            <span class="token function">setResults</span><span class="token punctuation">(</span><span class="token function">search</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token script language-javascript">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token script language-javascript">        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">      <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResults</span></span> <span class="token attr-name">results</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>results<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="// 사용자가 입력창에 타이핑 중
function SearchInput() {
  const [query, setQuery] = useState(&#x27;&#x27;);
  const [results, setResults] = useState([]);

  return (
    &lt;div&gt;
      &lt;input 
        value={query}
        onChange={(e) =&gt; {
          // 고우선순위: 즉시 처리
          setQuery(e.target.value);
          
          // 저우선순위: 나중에 처리
          startTransition(() =&gt; {
            setResults(search(e.target.value));
          });
        }}
      /&gt;
      &lt;SearchResults results={results} /&gt;
    &lt;/div&gt;
  );
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>React 18에서 등장한 <code>startTransition</code>같은 경우에는 우선순위를 낮게 처리하여 사용자가 빠르게 타이핑하면, 입력 반영은 즉시 되지만 검색 결과는 타이핑이 끝날 때까지 기다릴 수 있게 됩니다.</p>
<h3 id="실제-렌더링-과정-예시"><a class="anchor" aria-hidden="true" tabindex="-1" href="#실제-렌더링-과정-예시"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>실제 렌더링 과정 예시</h3>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ModernApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">,</span> setResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleSearch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment">// 고우선순위: 즉시 스케줄링 (InputContinuousLane)</span>
</span><span class="code-line">    <span class="token function">setQuery</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment">// 저우선순위: 지연 스케줄링 (TransitionLane)</span>
</span><span class="code-line">    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">setResults</span><span class="token punctuation">(</span><span class="token function">heavySearch</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment">// 실제 타임라인:</span>
</span><span class="code-line">    <span class="token comment">// T0: 사용자 타이핑</span>
</span><span class="code-line">    <span class="token comment">// T1: setQuery 업데이트 즉시 스케줄링</span>
</span><span class="code-line">    <span class="token comment">// T2: Render Phase - query 상태 업데이트, 입력창 즉시 반영</span>
</span><span class="code-line">    <span class="token comment">// T3: Commit Phase - DOM 업데이트 완료</span>
</span><span class="code-line">    <span class="token comment">// T4: startTransition 업데이트 낮은 우선순위로 스케줄링</span>
</span><span class="code-line">    <span class="token comment">// T5: 만약 사용자가 또 타이핑하면 T4의 작업은 중단되고 새로운 고우선순위 작업 시작</span>
</span><span class="code-line">    <span class="token comment">// T6: 타이핑이 멈추면 그때서야 heavySearch 결과 렌더링</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> 
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleSearch<span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> isPending <span class="token operator">?</span> <span class="token number">0.7</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">      <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResults</span></span> <span class="token attr-name">results</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>results<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="function ModernApp() {
  const [query, setQuery] = useState(&#x27;&#x27;);
  const [results, setResults] = useState([]);
  const [isPending, startTransition] = useTransition();
  
  const handleSearch = (e) =&gt; {
    const value = e.target.value;
    
    // 고우선순위: 즉시 스케줄링 (InputContinuousLane)
    setQuery(value);
    
    // 저우선순위: 지연 스케줄링 (TransitionLane)
    startTransition(() =&gt; {
      setResults(heavySearch(value));
    });
    
    // 실제 타임라인:
    // T0: 사용자 타이핑
    // T1: setQuery 업데이트 즉시 스케줄링
    // T2: Render Phase - query 상태 업데이트, 입력창 즉시 반영
    // T3: Commit Phase - DOM 업데이트 완료
    // T4: startTransition 업데이트 낮은 우선순위로 스케줄링
    // T5: 만약 사용자가 또 타이핑하면 T4의 작업은 중단되고 새로운 고우선순위 작업 시작
    // T6: 타이핑이 멈추면 그때서야 heavySearch 결과 렌더링
  };
  
  return (
    &lt;div&gt;
      &lt;input 
        value={query}
        onChange={handleSearch}
        style={{ opacity: isPending ? 0.7 : 1 }}
      /&gt;
      &lt;SearchResults results={results} /&gt;
    &lt;/div&gt;
  );
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<h2 id="메모이제이션에-대한-나의-생각을-적어주세요"><a class="anchor" aria-hidden="true" tabindex="-1" href="#메모이제이션에-대한-나의-생각을-적어주세요"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>메모이제이션에 대한 나의 생각을 적어주세요.</h2>
<p>최적화 얘기가 나올때마다 그렇게 유명한 Kent C 아저씨도 &#x27;성능 최적화는 항상 그 비용이 따르고, 언제나 이점을 제공하는것은 아닙니다.&#x27;라고 이야기 하는 것을 본적이 있었습니다. 그런데 어떤 모회사에서는 <a href="https://attardi.org/why-we-memo-all-the-things/">Stefano</a>의 글처럼 모든 부분을 메모하는 것을 컨벤션으로 둔다고 들었습니다. 저 글의 저자인 Stefano는 부분적인 최적화가 아니라 기본적으로 모든 컴포넌트를 메모하는 것이 더 효율적이라고 주장하는데, 모든 개발자들이 메모이제이션을 통한 최적화를 고려할 때 &#x27;어떤 부분을 메모할지&#x27;에 대해 고려할 지에 대한 비용을 줄이고 잠재적인 성능 저하를 방지하자 라고 이야기 하고 있습니다. 그리고 기본적으로 사용하는 것이 React 애플리케이션의 성능과 개발 효율성을 높이는 &#x27;합리적인 기본값&#x27;이다고 까지 했는데...</p>
<p>재밌는 점은 React 팀의 <a href="https://react.dev/blog/2024/10/21/react-compiler-beta-release">공식 블로그</a>에서 다음과 같이 언급했다는 점입니다.</p>
<blockquote>
<p>Before rolling out the compiler at Meta, we discovered that only about 8% of React pull requests used manual memoization and that these pull requests took 31-46% longer to author<a href="https://react.dev/blog/2024/10/21/react-compiler-beta-release#user-content-fn-3">3</a>. This confirmed our intuition that manual memoization introduces cognitive overhead,
Meta에서 컴파일러를 출시하기 전에는 React 풀 리퀘스트의 약 8%만이 수동 메모화를 사용했으며, 이러한 풀 리퀘스트를 작성하는 데 31-46% 더 오래 걸리는 것을 발견했습니다. 이를 통해 수동 메모화가 인지적 오버헤드를 유발한다는 직관을 확인할 수 있었습니다.</p>
</blockquote>
<p>메타 사람들도 React 만들어놓고... 8퍼만 수동 메모이제이션을 한다는데... 내가... <strong>해야할까?</strong> 그리고 Stefano가 말한 &#x27;개발 효율성을 높임&#x27;에 대해 반하는 내용이 아닌가? 하는 생각도 들었습니다.</p>
<p>또 다른 리액트 블로그 글에서는 이렇게 얘기하고 있습니다.</p>
<blockquote>
<p>In our current APIs, this means applying the <a href="https://react.dev/reference/react/useMemo">useMemo</a>, <a href="https://react.dev/reference/react/useCallback">useCallback</a>, and <a href="https://react.dev/reference/react/memo">memo</a> APIs to manually tune how much React re-renders on state changes. But manual memoization is a compromise. It clutters up our code, is easy to get wrong, and requires extra work to keep up to date.
현재 API에서는 state 변경 시 React가 리렌더링하는 양을 수동으로 조정하기 위해 useMemo, useCallback, memo API를 적용하는 것을 의미합니다. 하지만 수동 메모화는 타협점입니다. 코드가 복잡해지고 잘못되기 쉬우며 최신 상태를 유지하기 위해 추가 작업이 필요합니다.</p>
</blockquote>
<p>솔직히 어느 정도는 무책임하다는 생각이 들었던 것 같습니다(ㅋㅋ). 아 그러니까 이제 컴파일러 나올거니까 이전 패러다임(API)는 다 불편했다 요런걸까요? <del>컴파일러를 앞광고하기 위한 수단으로 여태까지의 수동 메모이제이션 API들을 다...</del></p>
<p>당연히 리액트 컴파일러는 게임 체인저라 생각하지만 당장 프로덕트에 적용하기에는 리스크가 있다고 생각합니다. 그래서 저 개인적으로 어떤 방식으로 메모이제이션을 접근해야할지를 생각해봤습니다.</p>
<ol>
<li>무거운 연산은 측정을 해보자.</li>
<li>명확한 케이스에만 메모이제이션을 하자. (복잡한 계산이라던가...등등)</li>
<li>팀 컨벤션을 정하자.</li>
</ol>
<p>하지만 실무 경험상 1, 2번은 정말 체감상 느리다고 느껴지는 특수한 상황에서만 의미가 있습니다. 복잡한 계산이나 대용량 데이터 처리 같은 명확한 성능 병목점이 아닌 이상, 대부분의 경우 메모이제이션으로 인한 성능 개선을 체감하기 어렵습니다.
따라서 3번 팀 컨벤션이 가장 중요한 방향이라고 생각합니다. 체감되지 않는 메모이제이션 보다는 팀 전체의 개발 효율성과 코드 일관성이 더 큰 가치를 가진다고 생각되어서 입니다.</p>
<p>메모이제이션은 갑론을박도 많고, 리액트 컴파일러가 안정적으로 도입되기 전까지는 계속 팀 내에서도 논의될 만한 주제라고 생각합니다. 그러나 메모이제이션을 하는 것에 있어서도 개발자가 잘 파악하고 사용해야한다는 점, 어느정도 그를 파악하는 것에 병목이 있다는 점, 그리고 그 병목 리소스를 생각하는 것에 비해 그렇게 체감할만한 차이가 현대 브라우저에서는 없다는 점을 생각했을때 명확한 성능 이슈가 측정되었을때만 적용하고 그보단 팀에서 합의된 컨벤션이 있다면 그를 따르는 것이 좋지 않을까 생각합니다.</p>
<h3 id="출처"><a class="anchor" aria-hidden="true" tabindex="-1" href="#출처"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>출처</h3>
<p><a href="https://kentcdodds.com/blog/usememo-and-usecallback">https://kentcdodds.com/blog/usememo-and-usecallback</a>
<a href="https://attardi.org/why-we-memo-all-the-things/">https://attardi.org/why-we-memo-all-the-things/</a>
<a href="https://react.dev/blog/2024/02/15/react-labs-what-we-have-been-working-on-february-2024">https://react.dev/blog/2024/02/15/react-labs-what-we-have-been-working-on-february-2024</a>
<a href="https://react.dev/blog/2024/10/21/react-compiler-beta-release">https://react.dev/blog/2024/10/21/react-compiler-beta-release</a></p>
<h2 id="컨텍스트와-상태관리에-대한-나의-생각을-적어주세요"><a class="anchor" aria-hidden="true" tabindex="-1" href="#컨텍스트와-상태관리에-대한-나의-생각을-적어주세요"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>컨텍스트와 상태관리에 대한 나의 생각을 적어주세요.</h2>
<p>취준일때부터 들었던 얘기였는데...Context는 전역 상태 관리 도구가 아니라 <code>의존성 주입 도구</code>로 바라보는 것이 중요하다고 생각합니다. Redux의 메인테이너인 Mark Erikson이 쓴 엄청 <a href="https://blog.isquaredsoftware.com/2021/01/context-redux-differences/">유명한 글</a>이 하나 있는데, 해당 글에서는 Redux와 Context를 비교하면서 상태관리란 4가지 필수 요구사항이 있다고 기술합니다.</p>
<ol>
<li>상태 저장 (Storing state values)</li>
<li>상태 읽기 (Reading state values)</li>
<li>상태 업데이트 (Updating state values)</li>
<li>변경 알림 (Notifying about changes)
위 네 개중에 상태를 업데이트하는 부분을 Context API는 충족하지 못합니다. 값을 읽고 저장하고 변경을 알릴 수 있지만 업데이트하는 내장 메커니즘이 없습니다. 그래서 Context + useState(혹은 useReducer)를 통해 상태 관리가 가능하다고 얘기하는 것입니다.</li>
</ol>
<p>잠깐 혹자들이 말하는 Context는 전역 상태 관리 도구가 아니라 <code>의존성 주입 도구</code>다에 대해서 설명을 해보겠습니다.
일단 SOLID 법칙을 생각해보면 그중에 D(Dependency Injection)가 해당하는 부분이라 할 수 있습니다.</p>
<p>이 의존성 주입은 3가지 요소로 구성됩니다.</p>
<ol>
<li>의존성: 어떤 객체가 동작하기 위해 필요한 다른 객체</li>
<li>주입: 의존성을 외부에서 제공하는 행위</li>
<li>역전: 의존성을 직접 생성하지 않고 외부에서 받는 제어의 역전</li>
</ol>
<p>이것만 봐서는 당연히 어떤 말인지 모를텐데, 간단하게 이야기하자면 &quot;필요한 도구를 직접 만들지 말고, 누군가 갖다 주는 걸 쓰자&quot;라고 생각합니다. 개발자가 코드를 짜기 위해서 맥북을 가져오고 하는게 아니라 누군가가 최신식 맥북을 가져다 주는...암튼 토스의 두에싸 같은 느낌이랄까요.(우하하)</p>
<p>다시 컴포넌트로 돌아가보자면, 상위 컴포넌트에서 필요한 도구들을 준비하고 Context라는 통로를 통해서 하위 컴포넌트에 전달해주면 이 도구들을 받기만해도 된다! 요런 느낌이라 생각합니다.</p>
<p>Context와 useState를 조합하면 props drilling 문제는 해결되지만, <code>선택적 구독</code>이 불가능합니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line"><span class="token comment">// Context + useState 조합</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">AppStateContext</span> <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AppStateProvider</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>theme<span class="token punctuation">,</span> setTheme<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;light&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>cart<span class="token punctuation">,</span> setCart<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>notifications<span class="token punctuation">,</span> setNotifications<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token comment">// 이 value 객체가 매번 새로 생성됨</span>
</span><span class="code-line">  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    user<span class="token punctuation">,</span> setUser<span class="token punctuation">,</span>
</span><span class="code-line">    theme<span class="token punctuation">,</span> setTheme<span class="token punctuation">,</span>
</span><span class="code-line">    cart<span class="token punctuation">,</span> setCart<span class="token punctuation">,</span>
</span><span class="code-line">    notifications<span class="token punctuation">,</span> setNotifications
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppStateContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AppStateContext.Provider</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 이 컴포넌트는 theme만 필요함</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ThemeButton</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> theme<span class="token punctuation">,</span> setTheme <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppStateContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;ThemeButton 렌더링&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// user, cart, notifications 변경 시에도 출력됨!</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setTheme</span><span class="token punctuation">(</span>theme <span class="token operator">===</span> <span class="token string">&#x27;light&#x27;</span> <span class="token operator">?</span> <span class="token string">&#x27;dark&#x27;</span> <span class="token operator">:</span> <span class="token string">&#x27;light&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// 이 컴포넌트는 cart만 필요함  </span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">CartCounter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> cart <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppStateContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;CartCounter 렌더링&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// user, theme, notifications 변경 시에도 출력됨!</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">장바구니: </span><span class="token punctuation">{</span>cart<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">}</span><span class="token plain-text">개</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="// Context + useState 조합
const AppStateContext = createContext();

function AppStateProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState(&#x27;light&#x27;);
  const [cart, setCart] = useState([]);
  const [notifications, setNotifications] = useState([]);
  
  // 이 value 객체가 매번 새로 생성됨
  const value = {
    user, setUser,
    theme, setTheme,
    cart, setCart,
    notifications, setNotifications
  };
  
  return (
    &lt;AppStateContext.Provider value={value}&gt;
      {children}
    &lt;/AppStateContext.Provider&gt;
  );
}

// 이 컴포넌트는 theme만 필요함
function ThemeButton() {
  const { theme, setTheme } = useContext(AppStateContext);
  console.log(&#x27;ThemeButton 렌더링&#x27;); // user, cart, notifications 변경 시에도 출력됨!
  
  return (
    &lt;button onClick={() =&gt; setTheme(theme === &#x27;light&#x27; ? &#x27;dark&#x27; : &#x27;light&#x27;)}&gt;
      {theme}
    &lt;/button&gt;
  );
}

// 이 컴포넌트는 cart만 필요함  
function CartCounter() {
  const { cart } = useContext(AppStateContext);
  console.log(&#x27;CartCounter 렌더링&#x27;); // user, theme, notifications 변경 시에도 출력됨!
  
  return &lt;span&gt;장바구니: {cart.length}개&lt;/span&gt;;
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>user가 바뀌면 theme만 쓰는 컴포넌트도 리렌더링되고, cart가 바뀌면 notifications만 쓰는 컴포넌트도 리렌더링됩니다. Context는 전체 value가 바뀌었는지만 확인하기 때문입니다. 반면 Zustand 같은 전역 상태 라이브러리는 선택적 구독이 가능합니다. 코드를 작성하면 너무 길어질것 같아서...남기진 않는데, 비슷하게 작성한뒤 확인하면 user가 바뀌어도 ThemeButton과 CartCounter는 리렌더링되지 않습니다. 각 컴포넌트가 정말 필요한 상태만 구독하기 때문입니다. 따라서 만약 전역상태 관리를 필요로 정말 필요로한다면 전역상태 관리 라이브러리를 고려해보는 것이 어느정도의 관심사의 분리와 성능을 가져갈 수 있는 방법이라고 생각합니다.</p>
<p>Context와 전역상태 라이브러리의 차이점에 대해서만 위에서 언급을 했는데, 그 둘의 조합을 이야기 해보자면, Context는 스코프를 지정하는 역할로도 사용됩니다.</p>
<p>Zustand, Redux, Jotai 같은 전역 상태 라이브러리들의 가장 큰 특징이자 한계는 <code>정말로 전역</code>이라는 점입니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token comment">// Zustand store는 앱 전체에서 하나의 인스턴스만 존재</span>
</span><span class="code-line"><span class="token keyword">const</span> useUserStore <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">set</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token literal-property property">currentUser</span><span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token function-variable function">setCurrentUser</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">currentUser</span><span class="token operator">:</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
</span><span class="code-line">      <span class="token operator">&lt;</span><span class="token maybe-class-name">UserProfile</span> <span class="token operator">/</span><span class="token operator">&gt;</span>     <span class="token punctuation">{</span><span class="token comment">/* 동일한 store 사용 */</span><span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token operator">&lt;</span><span class="token maybe-class-name">AdminPanel</span> <span class="token operator">/</span><span class="token operator">&gt;</span>      <span class="token punctuation">{</span><span class="token comment">/* 동일한 store 사용 */</span><span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token operator">&lt;</span><span class="token maybe-class-name">GuestView</span> <span class="token operator">/</span><span class="token operator">&gt;</span>       <span class="token punctuation">{</span><span class="token comment">/* 동일한 store 사용 */</span><span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="// Zustand store는 앱 전체에서 하나의 인스턴스만 존재
const useUserStore = create((set) =&gt; ({
  currentUser: null,
  setCurrentUser: (user) =&gt; set({ currentUser: user })
}));

function App() {
  return (
    &lt;div&gt;
      &lt;UserProfile /&gt;     {/* 동일한 store 사용 */}
      &lt;AdminPanel /&gt;      {/* 동일한 store 사용 */}
      &lt;GuestView /&gt;       {/* 동일한 store 사용 */}
    &lt;/div&gt;
  );
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>요런 상황에서 Context와 함께 조합해서 사용하면 스코프 지정이 가능합니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PersonalTodos</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token function">useTodoStore</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=&gt;</span> state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token function">useTodoStore</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=&gt;</span> state<span class="token punctuation">.</span><span class="token property-access">addTodo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token comment">// 개인 할 일에 추가해도 팀 할 일에는 영향 없음</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
</span><span class="code-line">      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">&#x27;개인 미팅 준비&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
</span><span class="code-line">        개인 할 일 추가
</span><span class="code-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</span><span class="code-line">      <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
</span><span class="code-line">        <span class="token punctuation">{</span>todos<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=&gt;</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</span><span class="code-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TeamTodos</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token function">useTodoStore</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=&gt;</span> state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 완전히 다른 todos 배열</span>
</span><span class="code-line">  <span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token function">useTodoStore</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=&gt;</span> state<span class="token punctuation">.</span><span class="token property-access">addTodo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
</span><span class="code-line">      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">&#x27;스프린트 계획&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
</span><span class="code-line">        팀 할 일 추가
</span><span class="code-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</span><span class="code-line">      <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
</span><span class="code-line">        <span class="token punctuation">{</span>todos<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=&gt;</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</span><span class="code-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</span><span class="code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="function PersonalTodos() {
  const todos = useTodoStore(state =&gt; state.todos);
  const addTodo = useTodoStore(state =&gt; state.addTodo);
  
  // 개인 할 일에 추가해도 팀 할 일에는 영향 없음
  return (
    &lt;div&gt;
      &lt;button onClick={() =&gt; addTodo(&#x27;개인 미팅 준비&#x27;)}&gt;
        개인 할 일 추가
      &lt;/button&gt;
      &lt;ul&gt;
        {todos.map(todo =&gt; &lt;li key={todo.id}&gt;{todo.text}&lt;/li&gt;)}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}

function TeamTodos() {
  const todos = useTodoStore(state =&gt; state.todos);  // 완전히 다른 todos 배열
  const addTodo = useTodoStore(state =&gt; state.addTodo);
  
  return (
    &lt;div&gt;
      &lt;button onClick={() =&gt; addTodo(&#x27;스프린트 계획&#x27;)}&gt;
        팀 할 일 추가
      &lt;/button&gt;
      &lt;ul&gt;
        {todos.map(todo =&gt; &lt;li key={todo.id}&gt;{todo.text}&lt;/li&gt;)}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>이렇게 &#x27;너는 이 스코프에서 동작하는 상태야 다른데서는 안쓸거야&#x27;라는 늬앙스로 스코프를 지정해 줄 수 있게되는 것입니다.</p>
<p>아무튼 정리하자면 Context는 상태관리가 아닌 의존성 주입의 도구이고, Context를 이용해서 스코프를 정의해 줄 수 있다고 생각합니다.</p>
<h3 id="출처-1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#출처-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>출처</h3>
<p><a href="https://blog.isquaredsoftware.com/2021/01/context-redux-differences/">https://blog.isquaredsoftware.com/2021/01/context-redux-differences/</a></p>
<h1 id="리뷰-받고-싶은-내용"><a class="anchor" aria-hidden="true" tabindex="-1" href="#리뷰-받고-싶은-내용"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>리뷰 받고 싶은 내용</h1>
<h3 id="1-추가한-테스트에-대하여-해당-테스트가-정말-의미가-있을지-궁금합니다"><a class="anchor" aria-hidden="true" tabindex="-1" href="#1-추가한-테스트에-대하여-해당-테스트가-정말-의미가-있을지-궁금합니다"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>1. <a href="https://github.com/hanghae-plus/front_6th_chapter1-3/pull/13/commits/484b483ae794837ec30b2d364cf464c80c338879">추가한 테스트</a>에 대하여, 해당 테스트가 정말 의미가 있을지 궁금합니다.</h3>
<p>제가 검증하고 싶은 내용은 외부적으로 강제로 컴포넌트를 통해서가 아닌 수동으로 로컬스토리지를 조작하는 상황을 검증하고 싶은데, 해당 테스트를 통해 그부분을 검증할 수 있을까? 하는 생각이 들어서요! 이런 부분에 대해서는 검증을 하지 않는 것이 맞는 선택인지? 아니면 임의적으로라도 저렇게 검증할 수 있다면 좋은 선택일지..궁금합니다. 또한 만약에 테스트를 한다면 어떻게 검증 가능할까요?
추가한 코드는 다음과 같습니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;외부에서 localStorage 직접 변경 시 감지해야 한다&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> storage1 <span class="token operator">=</span> createStorage<span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;external-change-test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token keyword">const</span> storage2 <span class="token operator">=</span> createStorage<span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;external-change-test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">result</span><span class="token operator">:</span> result1 <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">useStorage</span><span class="token punctuation">(</span>storage1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">result</span><span class="token operator">:</span> result2 <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">useStorage</span><span class="token punctuation">(</span>storage2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token comment">// 초기값 설정</span>
</span><span class="code-line">      <span class="token function">act</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> storage1<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token function">expect</span><span class="token punctuation">(</span>result1<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token function">expect</span><span class="token punctuation">(</span>result2<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token function">act</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">const</span> newData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Jane&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;external-change-test&quot;</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>newData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">const</span> customEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">&quot;storage-inner-document&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token literal-property property">detail</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;external-change-test&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token literal-property property">oldValue</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token literal-property property">newValue</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>newData<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">dispatchEvent</span><span class="token punctuation">(</span>customEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token function">expect</span><span class="token punctuation">(</span>result1<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Jane&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token function">expect</span><span class="token punctuation">(</span>result2<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Jane&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;다른 탭에서의 변경을 감지해야 한다 (storage 이벤트)&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> storage <span class="token operator">=</span> createStorage<span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token literal-property property">theme</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;cross-tab-test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token keyword">const</span> <span class="token punctuation">{</span> result <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">useStorage</span><span class="token punctuation">(</span>storage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token comment">// 초기값 설정</span>
</span><span class="code-line">      <span class="token function">act</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> storage<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">&quot;light&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">&quot;light&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token function">act</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">const</span> newData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">&quot;dark&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;cross-tab-test&quot;</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>newData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">dispatchEvent</span><span class="token punctuation">(</span>
</span><span class="code-line">          <span class="token keyword">new</span> <span class="token class-name">StorageEvent</span><span class="token punctuation">(</span><span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;cross-tab-test&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token literal-property property">oldValue</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">&quot;light&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token literal-property property">newValue</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>newData<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token literal-property property">storageArea</span><span class="token operator">:</span> <span class="token dom variable">localStorage</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">&quot;dark&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><div class="copied" data-code="    it(&quot;외부에서 localStorage 직접 변경 시 감지해야 한다&quot;, () =&gt; {
      const storage1 = createStorage&lt;{ name: string }&gt;(&quot;external-change-test&quot;);
      const storage2 = createStorage&lt;{ name: string }&gt;(&quot;external-change-test&quot;);

      const { result: result1 } = renderHook(() =&gt; useStorage(storage1));
      const { result: result2 } = renderHook(() =&gt; useStorage(storage2));

      // 초기값 설정
      act(() =&gt; storage1.set({ name: &quot;John&quot; }));
      expect(result1.current).toEqual({ name: &quot;John&quot; });
      expect(result2.current).toEqual({ name: &quot;John&quot; });

      act(() =&gt; {
        const newData = { name: &quot;Jane&quot; };
        localStorage.setItem(&quot;external-change-test&quot;, JSON.stringify(newData));

        const customEvent = new CustomEvent(&quot;storage-inner-document&quot;, {
          detail: {
            key: &quot;external-change-test&quot;,
            oldValue: JSON.stringify({ name: &quot;John&quot; }),
            newValue: JSON.stringify(newData),
          },
        });

        window.dispatchEvent(customEvent);
      });

      expect(result1.current).toEqual({ name: &quot;Jane&quot; });
      expect(result2.current).toEqual({ name: &quot;Jane&quot; });
    });

    it(&quot;다른 탭에서의 변경을 감지해야 한다 (storage 이벤트)&quot;, () =&gt; {
      const storage = createStorage&lt;{ theme: string }&gt;(&quot;cross-tab-test&quot;);
      const { result } = renderHook(() =&gt; useStorage(storage));

      // 초기값 설정
      act(() =&gt; storage.set({ theme: &quot;light&quot; }));
      expect(result.current).toEqual({ theme: &quot;light&quot; });

      act(() =&gt; {
        const newData = { theme: &quot;dark&quot; };
        localStorage.setItem(&quot;cross-tab-test&quot;, JSON.stringify(newData));

        window.dispatchEvent(
          new StorageEvent(&quot;storage&quot;, {
            key: &quot;cross-tab-test&quot;,
            oldValue: JSON.stringify({ theme: &quot;light&quot; }),
            newValue: JSON.stringify(newData),
            storageArea: localStorage,
          }),
        );
      });

      expect(result.current).toEqual({ theme: &quot;dark&quot; });
    });
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<h3 id="2-useeffect-추가-구현부"><a class="anchor" aria-hidden="true" tabindex="-1" href="#2-useeffect-추가-구현부"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>2. useEffect 추가 구현부</h3>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">type <span class="token function-variable function"><span class="token maybe-class-name">EffectCallback</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">effect</span><span class="token operator">:</span> <span class="token maybe-class-name">EffectCallback</span><span class="token punctuation">,</span> deps<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">DependencyList</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> prevDepsRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span><span class="token maybe-class-name">DependencyList</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> cleanupRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">const</span> isFirstRenderRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> depsChanged <span class="token operator">=</span>
</span><span class="code-line">    deps <span class="token operator">===</span> <span class="token keyword nil">undefined</span> <span class="token operator">||</span> prevDepsRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">===</span> <span class="token keyword nil">undefined</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">shallowEquals</span><span class="token punctuation">(</span>prevDepsRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">,</span> deps<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isFirstRenderRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">||</span> depsChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>cleanupRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> cleanupRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      cleanupRef<span class="token punctuation">.</span><span class="token method function property-access">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">const</span> cleanup <span class="token operator">=</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    cleanupRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> cleanup<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    prevDepsRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> deps<span class="token punctuation">;</span>
</span><span class="code-line">    isFirstRenderRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code><div class="copied" data-code="type EffectCallback = () =&gt; void | (() =&gt; void);

export function useEffect(effect: EffectCallback, deps?: DependencyList): void {
  const prevDepsRef = useRef&lt;DependencyList | undefined&gt;(undefined);
  const cleanupRef = useRef&lt;(() =&gt; void) | void&gt;(undefined);
  const isFirstRenderRef = useRef&lt;boolean&gt;(true);

  const depsChanged =
    deps === undefined || prevDepsRef.current === undefined || !shallowEquals(prevDepsRef.current, deps);

  if (isFirstRenderRef.current || depsChanged) {
    if (cleanupRef.current &amp;&amp; typeof cleanupRef.current === &quot;function&quot;) {
      cleanupRef.current();
    }

    const cleanup = effect();
    cleanupRef.current = cleanup;

    prevDepsRef.current = deps;
    isFirstRenderRef.current = false;
  }
}
"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
<p>위와 같이 useEffect를 구현했는데 지금은 렌더링 시에 동기적으로 effect를 실행하는데, 사실 React의 실제 useEffect는 렌더링이 완료된 후 비동기적으로 실행되어 제 코드와 조금 다르게 느껴집니다. 어떻게하면 effect를 비동기적으로 실행시킬 수 있을까요? queueMicrotask를 쓰라는데...그렇게하니까 테스트가 깨져서...전반적으로 테스트를 바꿔야할지..? 그렇다면 waitfor을 통해서 호출을 비동기적으로 기다리게 해야할거같은데 useEffect는 사실 &#x27;비동기적&#x27;으로 돌아가는것이지 &#x27;비동기&#x27;함수인것은 아니라고 생각돼서 목적이 맞는것인지 의문입니다.</p>
<h3 id="출처-2"><a class="anchor" aria-hidden="true" tabindex="-1" href="#출처-2"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>출처</h3>
<p><a href="https://www.velotio.com/engineering-blog/react-fiber-algorithm">https://www.velotio.com/engineering-blog/react-fiber-algorithm</a>
<a href="https://dev.to/thee_divide/reconciliation-react-rendering-phases-56g2">https://dev.to/thee_divide/reconciliation-react-rendering-phases-56g2</a>
<a href="https://goidle.github.io/react/in-depth-react-reconciler_2/">https://goidle.github.io/react/in-depth-react-reconciler_2/</a>
<a href="https://legacy.reactjs.org/docs/implementation-notes.html#future-directions">https://legacy.reactjs.org/docs/implementation-notes.html#future-directions</a></p></div></div><div class="overflow-auto mt-9"><div data-color-mode="dark" class="wmde-markdown wmde-markdown-color p-6 max-w-full" style="word-wrap:break-word;overflow-wrap:break-word"><h2 id="과제-피드백"><a class="anchor" aria-hidden="true" tabindex="-1" href="#과제-피드백"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>과제 피드백</h2>
<p>더 했으면 좋겠다고 하니 정말 더 하셨네요.
영서님 고생하셨습니다.
따로 과제나 회고에 대해서는 피드백을 드릴건 정말 잘 작성해주셔서 없을것 같고 다른 분들도 이걸 함께 나눠봤으면 좋겠네요.
작성된 하나하나의 주제들이 생각해보면 크고 알차기 때문에 발표나 글로..해서 하면 참 도움이 될 것 같고 좋겠네여</p>
<p>테스트 관련해서 답변해보면 노드 환경에서 할 수 있는 최대한의 시나리오 테스트 였던 것 같아요. 이 시스템 자체를 구현하는 관점에서 명확하게 하면 좋은 테스트이고 유의미했다고 생각해요. 다만 알겠지만, 해당 동작은 브라우저 구현에 달려있는 부분이 어느정도 있고 그게 잘 되었다는 가정하에 내용을 검증하는 것이기 때문에 지금 이벤트를 구현하는데 있어 복잡도가 높다보니 운영하는데 있어 그정도 효용이 있나~ 정도만 고민해보면 되지 않을까! (실제 모듈입장에서는 검증하는 범위가 같을 수도 있을 것 같아서요)</p>
<p>useEffect 구현 관련해서는 제가 알기로도 effect queue를 리액트에서 별도로 관리하기 때문에 큐를 별도로 쓰거나 하긴 해야할 것 같은데요. 아니면 setTimeout이나 Promise로 비슷...하게는 할 수 있을 것 같은데 직접 구현을 해봐야겠네요.
사실 알다시피 테스트는 이 과제를 위한 테스트이니 저도 추측이지만 waitFor를 사용해서 기다리는 게 어느정도 필요하지 않을까 싶어요. 저도 궁금한데 요거 한번 해보고 알려주실수 있나요? ㅎㅎㅎㅎ</p>
<p>고생하셨고 회고에서 남긴것처럼 코테전형이나 면접 일정이 남아있다고 하셨는데 준비 잘 하시고 우선순위 잘 나눠서 시간분배 잘 하고 과제 하셨으면 좋겠습니다.</p></div></div><div class="mt-9"></div></div></main></div></div></div></div>
</body>
</html>
